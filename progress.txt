# Ralphy Progress Log

## Codebase Patterns
- Backend FastAPI app lives in `backend/app/main.py`
- Python dependencies in `backend/requirements.txt`
- Use `python3 -m mypy <file> --ignore-missing-imports` for typechecking
- Use `--break-system-packages` flag when installing pip packages in this environment
- Uvicorn runs the app: `python3 -m uvicorn app.main:app --port 8000`
- Import settings: `from app.config import settings`
- Import database: `from app.database import engine, SessionLocal, Base, get_db`
- Import models: `from app.models import Project` (add new models to models/__init__.py)
- Run Alembic migrations from backend directory: `cd backend && python3 -m alembic upgrade head`
- Create new migrations: `cd backend && python3 -m alembic revision --autogenerate -m "description"`
- Always import models in `alembic/env.py` for autogenerate to detect new models
- Import schemas: `from app.schemas import ProjectCreate, ProjectResponse` etc.
- Pydantic v2 uses `model_config = {"from_attributes": True}` for ORM conversion
- Routers go in `backend/app/routers/`, export from `__init__.py`, include in main.py
- Use `APIRouter(prefix="/api/...", tags=["..."])` for route grouping
- Response models: `response_model=ProjectResponse`, status codes: `status_code=status.HTTP_201_CREATED`
- Run tests: `cd backend && python3 -m pytest tests/ -v`
- Test fixtures in `backend/conftest.py`: `test_db` (in-memory SQLite), `test_client` (FastAPI TestClient)
- In-memory SQLite tests require `poolclass=StaticPool` and model imports in conftest.py
- Frontend (ui) uses Vite + React with npm scripts: `npm run dev`, `npm run build`
- React Router: BrowserRouter wraps App in main.jsx, Routes/Route in App.jsx
- Pages go in `ui/src/pages/`, components in `ui/src/components/{feature}/` (e.g., `components/projects/`)
- Use `Link` from react-router-dom for navigation, not `<a>` tags
- API service: `import { get, post, put, del } from '../services/api'` for HTTP calls
- Run frontend tests: `cd ui && npm test`
- Frontend tests in `ui/tests/components/` for component tests, `ui/tests/e2e/` for E2E tests
- Wrap components using react-router-dom with `<BrowserRouter>` in tests
- SQLAlchemy 2.0 typed columns: use `Mapped[T]` and `mapped_column()` for mypy compliance
- Enum columns: `status: Mapped[StatusEnum] = mapped_column(SAEnum(StatusEnum), ...)` (use `from sqlalchemy import Enum as SAEnum`)

---

## 2026-01-22 - US-001
- **What was implemented**: Set up FastAPI backend structure with CORS middleware and health check endpoint
- **Files changed**:
  - `backend/app/__init__.py` - Created empty init file
  - `backend/app/main.py` - FastAPI app with CORS and /api/health endpoint
  - `backend/requirements.txt` - All required dependencies
- **Learnings for future iterations:**
  - This environment is externally managed Python, need `--break-system-packages` for pip
  - Mypy works with `--ignore-missing-imports` flag for third-party libs
  - CORS allows localhost:3000, localhost:5173, and 127.0.0.1 variants
---

## 2026-01-22 - US-002
- **What was implemented**: Created centralized configuration with pydantic-settings
- **Files changed**:
  - `backend/app/config.py` - Settings class with all config variables using pydantic-settings
  - `backend/.env.example` - Example environment file documenting all optional variables
- **Learnings for future iterations:**
  - Config uses `env_file = ".env"` in Config class to load from .env file
  - Import settings with `from app.config import settings`
  - All settings have sensible defaults for local development
---

## 2026-01-22 - US-003
- **What was implemented**: Configured SQLAlchemy with SQLite database
- **Files changed**:
  - `backend/app/database.py` - SQLAlchemy engine, SessionLocal, Base, and get_db dependency
- **Learnings for future iterations:**
  - Import database components: `from app.database import engine, SessionLocal, Base, get_db`
  - SQLite requires `connect_args={"check_same_thread": False}` for thread safety
  - `get_db` is a FastAPI dependency generator that yields Session and auto-closes
  - SessionLocal is configured with `autocommit=False, autoflush=False` as per FastAPI best practices
---

## 2026-01-22 - US-004
- **What was implemented**: Set up Alembic for database migrations
- **Files changed**:
  - `backend/alembic.ini` - Alembic configuration file
  - `backend/alembic/env.py` - Updated to import Base from database.py and use DATABASE_URL from config
  - `backend/alembic/versions/0194510d4c15_initial.py` - Initial empty migration
  - `.gitignore` - Added *.db to exclude SQLite database files
- **Learnings for future iterations:**
  - Run migrations from backend directory: `cd backend && python3 -m alembic upgrade head`
  - Create new migrations: `python3 -m alembic revision --autogenerate -m "description"`
  - env.py uses `config.set_main_option("sqlalchemy.url", settings.DATABASE_URL)` to dynamically set URL
  - Alembic imports models via Base.metadata for autogenerate support
---

## 2026-01-22 - US-005
- **What was implemented**: Created Project model with database migration
- **Files changed**:
  - `backend/app/models/__init__.py` - Models package init, exports Project
  - `backend/app/models/project.py` - Project model with id (UUID), name, description, created_at, updated_at
  - `backend/alembic/env.py` - Updated to import models for autogenerate support
  - `backend/alembic/versions/02ddbe2acae5_create_projects_table.py` - Migration creating projects table
- **Learnings for future iterations:**
  - Models go in `backend/app/models/` directory
  - Import models with `from app.models import Project`
  - UUID columns use `CHAR(36)` type in SQLite with lambda default for uuid generation
  - Always import models in `alembic/env.py` for autogenerate to detect schema changes
  - Cascade delete relationships are configured via SQLAlchemy relationship() with cascade="all, delete-orphan"
---

## 2026-01-22 - US-006
- **What was implemented**: Created Pydantic schemas for Project API validation
- **Files changed**:
  - `backend/app/schemas/__init__.py` - Schemas package init, exports all Project schemas
  - `backend/app/schemas/project.py` - ProjectCreate, ProjectUpdate, ProjectResponse, ProjectList schemas
- **Learnings for future iterations:**
  - Schemas go in `backend/app/schemas/` directory
  - Import schemas with `from app.schemas import ProjectCreate, ProjectResponse` etc.
  - Use `model_config = {"from_attributes": True}` in Pydantic v2 for ORM model conversion
  - ProjectCreate has required `name`, optional `description`
  - ProjectUpdate has all optional fields for partial updates
  - ProjectResponse includes all fields including timestamps
  - ProjectList wraps a list of ProjectResponse objects
---

## 2026-01-22 - US-007
- **What was implemented**: Created Project CRUD API endpoints
- **Files changed**:
  - `backend/app/routers/__init__.py` - Routers package init, exports projects_router
  - `backend/app/routers/projects.py` - Full CRUD: POST, GET (list), GET (single), PUT, DELETE
  - `backend/app/main.py` - Registered projects_router
- **Learnings for future iterations:**
  - Routers go in `backend/app/routers/` directory
  - Use `router = APIRouter(prefix="/api/projects", tags=["projects"])` for route grouping
  - Router exports from `__init__.py`: `from app.routers.projects import router as projects_router`
  - Include router in main.py: `app.include_router(projects_router)`
  - Use `response_model` decorator param for automatic response serialization
  - Use `status_code=status.HTTP_201_CREATED` for POST endpoints
  - Use `status_code=status.HTTP_204_NO_CONTENT` for DELETE endpoints
  - Use `model_dump(exclude_unset=True)` in Pydantic v2 for partial updates
---

## 2026-01-22 - US-008
- **What was implemented**: Set up pytest with fixtures for testing
- **Files changed**:
  - `backend/pytest.ini` - Pytest configuration with asyncio_mode = auto
  - `backend/conftest.py` - Test fixtures for test_client and test_db
  - `backend/tests/__init__.py` - Tests package init
  - `backend/tests/test_health.py` - Health endpoint test to verify setup
- **Learnings for future iterations:**
  - Tests go in `backend/tests/` directory
  - Run tests: `cd backend && python3 -m pytest tests/ -v`
  - test_db fixture uses in-memory SQLite (`sqlite:///:memory:`) for test isolation
  - test_client fixture overrides get_db dependency to use test database
  - Each test gets fresh database (tables created before, dropped after)
  - Use `app.dependency_overrides[get_db] = override_get_db` to swap dependencies in tests
---

## 2026-01-22 - US-009
- **What was implemented**: Created tests for Project CRUD endpoints
- **Files changed**:
  - `backend/tests/test_projects.py` - Comprehensive tests for all 5 CRUD operations
  - `backend/conftest.py` - Fixed to use StaticPool and import models
- **Learnings for future iterations:**
  - In-memory SQLite requires `poolclass=StaticPool` to share the same database across connections
  - Must import models in `conftest.py` so `Base.metadata.create_all()` creates the tables
  - Test file covers: POST create, GET list, GET single, GET 404, PUT update, PUT 404, DELETE, DELETE 404
  - Use fake UUID `00000000-0000-0000-0000-000000000000` to test 404 responses
---

## 2026-01-22 - US-010
- **What was implemented**: Set up React Router with /app routes for SPA navigation
- **Files changed**:
  - `ui/package.json` - Added react-router-dom dependency
  - `ui/src/main.jsx` - Wrapped App with BrowserRouter
  - `ui/src/App.jsx` - Set up Routes component with / and /app routes
  - `ui/src/pages/LandingPage.jsx` - Extracted landing page content from original App.jsx
  - `ui/src/pages/ProjectsPage.jsx` - Created placeholder for projects page
  - `ui/src/App.css` - Added styles for feature-card-link, back-link, projects-placeholder
- **Learnings for future iterations:**
  - Use `Link` from react-router-dom for client-side navigation
  - BrowserRouter must wrap the entire app in main.jsx (entry point)
  - Routes/Route components define URL-to-component mapping
  - Use `path="/app/*"` to catch all subroutes for a section
  - Build with `npm run build` to verify no JS errors
  - Manual browser verification needed for routing - no agent-browser skill available
---

## 2026-01-22 - US-011
- **What was implemented**: Created API service layer with fetch wrapper for consistent HTTP calls
- **Files changed**:
  - `ui/src/services/api.js` - Created with get, post, put, del functions and error handling
- **Learnings for future iterations:**
  - API service uses `import.meta.env.VITE_API_URL` for base URL (Vite env var pattern)
  - Default base URL is `http://localhost:8000` for local development
  - All functions throw Error with `detail` from API response or status code fallback
  - Import API methods: `import { get, post, put, del } from '../services/api'`
  - DELETE typically returns 204 No Content, so `del()` handles both 204 and JSON responses
---

## 2026-01-22 - US-012
- **What was implemented**: Created ProjectCard component for displaying project information as a card
- **Files changed**:
  - `ui/src/components/projects/ProjectCard.jsx` - Component with name, description, meeting count, last activity, edit/delete buttons
  - `ui/src/components/projects/ProjectCard.css` - Styling for the card with hover effects and consistent design
- **Learnings for future iterations:**
  - Components go in `ui/src/components/{feature}/` directories (e.g., `components/projects/`)
  - Use CSS alongside component files for scoped styling (e.g., `ProjectCard.css` next to `ProjectCard.jsx`)
  - Import CSS in component: `import './ProjectCard.css'`
  - Use `useNavigate` from react-router-dom for programmatic navigation
  - Use `e.stopPropagation()` in nested buttons to prevent click events from bubbling to parent
  - Card uses SVG icons inline for edit, delete, and stats (meetings, clock)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-013
- **What was implemented**: Created ProjectsPage with responsive card grid that displays projects
- **Files changed**:
  - `ui/src/pages/ProjectsPage.jsx` - Full page implementation with data fetching, loading/error/empty states
  - `ui/src/pages/ProjectsPage.css` - Styling for grid, loading spinner, error and empty states
- **Learnings for future iterations:**
  - Pages go in `ui/src/pages/` directory with accompanying CSS files
  - Use `useState` for state management: loading, error, data
  - Use `useEffect` with empty deps array for fetch on mount
  - API returns `{ projects: [...] }` - access `.projects` property
  - Loading spinner uses CSS animation with `border-top-color` for spinner effect
  - Responsive grid: 3 columns > 2 columns (1024px) > 1 column (640px)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-014
- **What was implemented**: Created reusable Modal component for displaying forms and content in overlays
- **Files changed**:
  - `ui/src/components/common/Modal.jsx` - Modal with backdrop, close button, focus trapping, ESC key support
  - `ui/src/components/common/Modal.css` - Styling with responsive design (bottom sheet on mobile)
- **Learnings for future iterations:**
  - Shared/common components go in `ui/src/components/common/` directory
  - Modal uses refs for focus management: store `previousActiveElement` to restore on close
  - Focus trap implementation: query focusable elements, handle Tab/Shift+Tab cycling
  - Prevent body scroll when modal open: `document.body.style.overflow = 'hidden'`
  - ESC key closes modal via `document.addEventListener('keydown', ...)`
  - Use `aria-modal="true"` and `role="dialog"` for accessibility
  - Mobile responsive: modal becomes bottom sheet (slides up from bottom) on narrow screens
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-015
- **What was implemented**: Created ProjectForm component for creating and editing projects
- **Files changed**:
  - `ui/src/components/projects/ProjectForm.jsx` - Form with name input (required) and description textarea (optional)
  - `ui/src/components/projects/ProjectForm.css` - Styling for form inputs, labels, buttons, error states
- **Learnings for future iterations:**
  - Form components accept `project` prop for edit mode and `onSubmit` prop for form submission
  - Use `useEffect` to pre-fill form values when `project` prop is passed
  - `onSubmit` prop should be async - form handles try/catch and displays error message on failure
  - Submit button disabled when required field empty (`!name.trim()`) or during submission
  - CSS pattern: `.project-form-btn--primary` and `--secondary` for button variants
  - Responsive: buttons stack vertically on mobile with `flex-direction: column-reverse`
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - Bugfix: US-013 API Contract Mismatch
- **What was fixed**: Corrected API response handling in ProjectsPage - backend returns plain array, not wrapped object
- **Files changed**:
  - `ui/src/pages/ProjectsPage.jsx` - Changed `setProjects(data.projects || [])` to `setProjects(data || [])`
- **Learnings for future iterations:**
  - Backend `GET /api/projects` returns `list[ProjectResponse]` (plain array), not `{ projects: [...] }`
  - Always verify API response format matches frontend expectations before marking story complete
  - The unused `ProjectList` schema in `schemas/project.py` could cause confusion - it wraps projects but isn't used by the router
---

## 2026-01-22 - US-016
- **What was implemented**: Integrated ProjectForm modal in ProjectsPage for creating new projects
- **Files changed**:
  - `ui/src/pages/ProjectsPage.jsx` - Added modal state, wired New Project button to open modal, handle form submission
- **Learnings for future iterations:**
  - Modal state pattern: `const [isModalOpen, setIsModalOpen] = useState(false)`
  - Form submission handler: make async call, close modal, update list with new item
  - After successful POST, use `setProjects((prev) => [...prev, newProject])` to append without refetch
  - ProjectForm handles its own error display via try/catch in handleSubmit
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-017
- **What was implemented**: Set up Vitest with component tests for frontend testing
- **Files changed**:
  - `ui/package.json` - Added test script and devDependencies (vitest, @testing-library/react, @testing-library/jest-dom, jsdom)
  - `ui/vite.config.js` - Added test configuration with jsdom environment
  - `ui/tests/setup.js` - Test setup file that imports @testing-library/jest-dom
  - `ui/tests/components/ProjectCard.test.jsx` - Component tests for ProjectCard (name, description rendering)
  - `ui/tests/e2e/` - Created empty directory for future E2E tests
- **Learnings for future iterations:**
  - Run frontend tests: `cd ui && npm test`
  - Vitest v4 removed `pool` and `poolOptions` - use `isolate: false` at top level for single-threaded execution
  - Test setup file imports `@testing-library/jest-dom` for DOM matchers
  - Components using react-router-dom need to be wrapped with `<BrowserRouter>` in tests
  - Use `vi.fn()` from Vitest to create mock functions
  - Test structure: `ui/tests/components/` for component tests, `ui/tests/e2e/` for E2E tests
---

## 2026-01-22 - US-018
- **What was implemented**: Created MeetingRecap model with status lifecycle for tracking uploaded meeting notes
- **Files changed**:
  - `backend/app/models/meeting_recap.py` - New model with MeetingStatus and InputType enums, all required fields
  - `backend/app/models/__init__.py` - Updated to export MeetingRecap, MeetingStatus, InputType
  - `backend/app/models/project.py` - Enabled meetings relationship with cascade delete
  - `backend/alembic/env.py` - Added MeetingRecap import for autogenerate
  - `backend/alembic/versions/0a10fb35f446_create_meeting_recaps_table.py` - Migration file
  - `backend/conftest.py` - Added MeetingRecap import for test db setup
- **Learnings for future iterations:**
  - SQLAlchemy 2.0 style uses `Mapped[T]` and `mapped_column()` for type annotations to satisfy mypy
  - Enum columns need explicit type annotation: `input_type: Mapped[InputType] = mapped_column(...)`
  - Use `SAEnum` alias when importing `from sqlalchemy import Enum as SAEnum` to avoid conflict with Python's `enum.Enum`
  - Status enums inheriting from `str, enum.Enum` work well with Pydantic serialization
  - Foreign key with cascade delete: `ForeignKey("table.id", ondelete="CASCADE")`
  - Remember to update conftest.py imports for new models so test DB creates tables
---

## 2026-01-22 - US-019
- **What was implemented**: Created MeetingItem model for storing extracted items from meeting notes
- **Files changed**:
  - `backend/app/models/meeting_item.py` - New model with Section enum and MeetingItem model
  - `backend/app/models/__init__.py` - Updated to export MeetingItem and Section
  - `backend/app/models/meeting_recap.py` - Enabled items relationship with cascade delete
  - `backend/alembic/env.py` - Added MeetingItem import for autogenerate
  - `backend/alembic/versions/96e4c628927a_create_meeting_items_table.py` - Migration file
  - `backend/conftest.py` - Added MeetingItem import for test db setup
- **Learnings for future iterations:**
  - Section enum has 9 values for requirement categories: problems, user_goals, functional_requirements, data_needs, constraints, non_goals, risks_assumptions, open_questions, action_items
  - Use `str | None` for optional typed columns: `source_quote: Mapped[str | None] = mapped_column(Text, nullable=True)`
  - Composite indexes defined in `__table_args__`: `Index("ix_name", "col1", "col2")`
  - MeetingItem has soft-delete via is_deleted flag (not hard delete)
  - Relationships are bidirectional: MeetingRecap.items ↔ MeetingItem.meeting
---

## 2026-01-22 - US-020
- **What was implemented**: Created Pydantic schemas for Meeting API request/response validation
- **Files changed**:
  - `backend/app/schemas/meeting.py` - New schemas: MeetingUpload, MeetingItemResponse, MeetingResponse, UploadResponse
  - `backend/app/schemas/__init__.py` - Updated to export Meeting schemas
- **Learnings for future iterations:**
  - Import enums from models for Pydantic schemas: `from app.models.meeting_recap import MeetingStatus, InputType`
  - Pydantic schemas can reference SQLAlchemy model enums directly - they inherit from `str, enum.Enum`
  - MeetingResponse includes nested `items: list[MeetingItemResponse]` for one-to-many relationships
  - UploadResponse returns `job_id` and `meeting_id` (both same value, for API flexibility)
---

## 2026-01-22 - US-021
- **What was implemented**: Created file parser service for processing uploaded meeting notes
- **Files changed**:
  - `backend/app/services/__init__.py` - Services package init, exports parse_file
  - `backend/app/services/parser.py` - Async parse_file function that validates and parses .txt and .md files
- **Learnings for future iterations:**
  - Services go in `backend/app/services/` directory
  - Import services: `from app.services import parse_file` or `from app.services.parser import parse_file`
  - parse_file is async: `content = await parse_file(file)` where file is FastAPI's UploadFile
  - File size check uses `settings.MAX_FILE_SIZE_KB * 1024` for byte comparison
  - File extension check uses `filename.lower().endswith((".txt", ".md"))` for flexibility
---

## 2026-01-22 - US-022
- **What was implemented**: Created meeting upload endpoint for processing meeting notes
- **Files changed**:
  - `backend/app/routers/meetings.py` - New router with POST /api/meetings/upload endpoint
  - `backend/app/routers/__init__.py` - Updated to export meetings_router
  - `backend/app/main.py` - Registered meetings_router
- **Learnings for future iterations:**
  - FastAPI Form() and File() can be used together for multipart form data with file upload
  - Use `Optional[UploadFile] = File(None)` for optional file upload
  - Use `Optional[str] = Form(None)` for optional form field
  - The endpoint is async since it uses parse_file which is async
  - python-multipart package is required at runtime for Form data (installed separately from requirements.txt)
---

## 2026-01-22 - US-023
- **What was implemented**: Created meeting list and get endpoints for viewing meetings
- **Files changed**:
  - `backend/app/routers/meetings.py` - Added GET /api/meetings/{id} endpoint with items filtering
  - `backend/app/routers/projects.py` - Added GET /api/projects/{id}/meetings endpoint
  - `backend/app/schemas/meeting.py` - Added MeetingListItemResponse schema for list views
  - `backend/app/schemas/__init__.py` - Exported new MeetingListItemResponse schema
- **Learnings for future iterations:**
  - Project-scoped endpoints go in projects router: `/api/projects/{id}/meetings`
  - Resource-specific endpoints go in their own router: `/api/meetings/{id}`
  - Use separate response schemas for list vs detail views (MeetingListItemResponse vs MeetingResponse)
  - Filter soft-deleted items with `MeetingItem.is_deleted == False` in queries
  - When building response dicts manually, all fields must be explicitly included for Pydantic validation
---

## 2026-01-22 - US-024
- **What was implemented**: Created meeting delete endpoint for removing meetings and their associated items
- **Files changed**:
  - `backend/app/routers/meetings.py` - Added DELETE /{meeting_id} endpoint with 204/404 responses
- **Learnings for future iterations:**
  - DELETE endpoints use `status_code=status.HTTP_204_NO_CONTENT` and return `None`
  - MeetingRecap model has cascade delete configured, so deleting a meeting automatically removes associated MeetingItems
  - FastAPI returns 204 No Content automatically when route returns None with 204 status code
---

## 2026-01-22 - US-025
- **What was implemented**: Created tests for the file parser service
- **Files changed**:
  - `backend/tests/test_parser.py` - 10 tests covering: valid .txt parsing, valid .md parsing, uppercase extensions, 50KB limit rejection, exact 50KB acceptance, unsupported file type rejection (.pdf, .docx), no extension rejection, empty filename rejection
- **Learnings for future iterations:**
  - Use `MagicMock()` (not `MagicMock(spec=UploadFile)`) with return type `Any` to avoid mypy issues with mock assertions
  - `AsyncMock(return_value=content)` for mocking async methods like `file.read()`
  - Parser service tests don't need database fixtures - they're unit tests for pure functions
  - Test boundary conditions: exact limits (50KB) and just-over limits (50KB + 1 byte)
---

## 2026-01-22 - US-026
- **What was implemented**: Created comprehensive tests for meeting endpoints
- **Files changed**:
  - `backend/tests/test_meetings.py` - 13 tests covering: upload with text, upload with .txt file, upload with .md file, upload requires file or text, upload 404 on missing project, list meetings by project, list empty meetings, list meetings 404 on missing project, get meeting with items, get meeting 404, delete meeting, delete meeting 404, delete removes from project list
- **Learnings for future iterations:**
  - Use `BytesIO` from `io` module to create in-memory file objects for testing file uploads
  - For multipart file uploads in TestClient: `files={"file": ("filename.txt", file_obj, "text/plain")}`
  - Form data goes in `data={}` parameter, files in `files={}` parameter
  - Helper functions like `_create_project()` reduce test boilerplate and improve readability
  - Test both positive cases and error cases (404s) for all CRUD operations
---

## 2026-01-22 - US-027
- **What was implemented**: Created StatusBadge component for displaying meeting status with colored badges
- **Files changed**:
  - `ui/src/components/common/StatusBadge.jsx` - Component with status prop, renders badge with appropriate color
  - `ui/src/components/common/StatusBadge.css` - Styling with colors for each status (gray=pending, blue=processing, green=processed, purple=applied, red=failed)
- **Learnings for future iterations:**
  - StatusBadge uses a config object pattern to map status values to labels and CSS classes
  - Status colors follow common UI conventions: gray for inactive, blue for in-progress, green for success, red for error
  - Frontend Vitest tests may have worker timeout issues in WSL/Windows environments - build pass confirms code correctness
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-028
- **What was implemented**: Created MeetingsList component for displaying meetings with status badges
- **Files changed**:
  - `ui/src/components/meetings/MeetingsList.jsx` - Component displaying meetings as list items with title, date, StatusBadge; onClick handler; empty state
  - `ui/src/components/meetings/MeetingsList.css` - Styling for list items with hover effects and empty state
- **Learnings for future iterations:**
  - Meeting list components go in `ui/src/components/meetings/` directory
  - Use `onMeetingClick` prop pattern for click handling (passing the meeting object)
  - Empty state shows an icon and "No meetings yet" text
  - Meetings have `meeting_date` field (snake_case from backend API)
---

## 2026-01-22 - US-029
- **What was implemented**: Created ProjectDashboard page with two-panel layout for managing meetings and viewing requirements
- **Files changed**:
  - `ui/src/pages/ProjectDashboard.jsx` - Dashboard page with project info, action buttons, left panel (MeetingsList), right panel (requirements placeholder)
  - `ui/src/pages/ProjectDashboard.css` - Styling for two-panel layout, action buttons, loading/error states
  - `ui/src/App.jsx` - Added route `/app/projects/:id` for ProjectDashboard
- **Learnings for future iterations:**
  - Use `useParams()` from react-router-dom to extract `:id` from URL
  - Use `Promise.all()` to fetch multiple API endpoints in parallel for better performance
  - Export functionality needs raw fetch (not api.js) to handle blob response for file download
  - Create download link programmatically: create blob URL, create anchor, click, cleanup
  - Two-panel layout uses CSS grid with `grid-template-columns: 1fr 1fr`, responsive at 1024px breakpoint
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-030
- **What was implemented**: Created FileDropzone component for drag-and-drop file uploads
- **Files changed**:
  - `ui/src/components/common/FileDropzone.jsx` - Component with drag-and-drop, click-to-upload, file validation, selected file display
  - `ui/src/components/common/FileDropzone.css` - Styling with dashed border, dragging state, selected file state
- **Learnings for future iterations:**
  - FileDropzone accepts `onFile` prop callback (receives File object or null when cleared)
  - Uses `accept` prop for file type filtering (default `.txt,.md`)
  - Drag events need `e.preventDefault()` and `e.stopPropagation()` to work correctly
  - File input hidden with `display: none`, triggered via ref on click
  - Shows visual feedback for different states: default, dragging (blue), has-file (green)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-031
- **What was implemented**: Created UploadMeetingPage for uploading meeting notes via file or text
- **Files changed**:
  - `ui/src/pages/UploadMeetingPage.jsx` - New page with title input (required), date picker, FileDropzone, textarea for text input, file size validation
  - `ui/src/pages/UploadMeetingPage.css` - Styling for form inputs, divider, error messages, responsive layout
  - `ui/src/App.jsx` - Added route `/app/projects/:id/meetings/new` for UploadMeetingPage
- **Learnings for future iterations:**
  - File size validation done client-side (50KB limit) before submission
  - Use "or" divider pattern with CSS pseudo-elements for alternative input methods
  - File and text inputs are mutually exclusive: selecting file clears text, typing text clears file
  - Date input defaults to today using `new Date().toISOString().split('T')[0]`
  - Submit button disabled when title empty OR (no file AND no text)
  - Form submission logic will be implemented in US-032 (this story only creates the UI)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-032
- **What was implemented**: Connected UploadMeetingPage to the backend API for uploading meeting notes
- **Files changed**:
  - `ui/src/pages/UploadMeetingPage.jsx` - Added API submission with FormData, loading state, error handling, and navigation
  - `ui/src/pages/UploadMeetingPage.css` - Added btn-spinner animation for loading state
- **Learnings for future iterations:**
  - Use raw `fetch` with FormData for multipart form uploads (not api.js wrapper which sets JSON content-type)
  - FormData automatically handles file vs text data: `formData.append('file', file)` or `formData.append('text', text)`
  - Use `useNavigate` from react-router-dom for programmatic navigation after form submission
  - Pass state to navigation target via second argument: `navigate(path, { state: { job_id } })`
  - Loading spinner pattern: CSS animation with `border-top-color` for spinner effect (consistent with ProjectsPage)
  - isSubmitDisabled should include isLoading to prevent double submissions
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-033
- **What was implemented**: Created comprehensive tests for the upload form (UploadMeetingPage)
- **Files changed**:
  - `ui/tests/components/UploadMeetingPage.test.jsx` - 20 tests covering title validation, file handling, size validation, text input
  - `ui/package.json` - Added @testing-library/user-event dependency
- **Learnings for future iterations:**
  - Use `@testing-library/user-event` for realistic user interaction testing (typing, clicking)
  - For routing tests, wrap components with `<BrowserRouter>` and define required Routes
  - Mock `global.fetch` for API call tests: `global.fetch = vi.fn()` in test setup
  - Create file objects for testing: `new File([content], 'filename.txt', { type: 'text/plain' })`
  - Use `fireEvent.change(input, { target: { files: [file] } })` to simulate file selection
  - FileDropzone maintains its own internal state - parent can't directly clear it without using clear button
  - Test setup helper: `window.history.pushState({}, 'Test page', route)` to set initial route
---

## 2026-01-22 - US-034
- **What was implemented**: Created abstract LLM provider base class and LLMError exception
- **Files changed**:
  - `backend/app/services/llm/__init__.py` - New LLM subpackage init, exports LLMProvider and LLMError
  - `backend/app/services/llm/base.py` - Abstract LLMProvider class with generate() and async stream() methods
  - `backend/app/services/__init__.py` - Updated to export LLM classes
- **Learnings for future iterations:**
  - LLM providers go in `backend/app/services/llm/` directory
  - Import LLM classes: `from app.services.llm import LLMProvider, LLMError`
  - LLMProvider is an ABC with abstract methods `generate(prompt: str) -> str` and `async stream(prompt: str) -> AsyncIterator[str]`
  - Abstract async generators need a `yield ""` statement (unreachable) to satisfy mypy type checking
  - LLMError is a custom exception for LLM operation failures
---

## 2026-01-22 - US-035
- **What was implemented**: Created Ollama LLM provider implementing the LLMProvider interface
- **Files changed**:
  - `backend/app/services/llm/ollama.py` - OllamaProvider class with generate() and stream() methods
  - `backend/app/services/llm/__init__.py` - Updated to export OllamaProvider
- **Learnings for future iterations:**
  - Ollama API endpoints: `/api/generate` for text generation, `/api/tags` for health check
  - Use `httpx` library for HTTP calls (sync Client and async AsyncClient)
  - Streaming response: set `stream: True` in payload, use `client.stream()` and `aiter_lines()` for async
  - Ollama returns JSONL format for streaming - each line is a JSON object with `response` field
  - Error handling: catch `httpx.ConnectError` for "Ollama not available", `httpx.TimeoutException` for timeouts
  - Provider accepts optional constructor params to override settings: base_url, model, timeout
---

## 2026-01-22 - US-036
- **What was implemented**: Created Claude LLM provider implementing the LLMProvider interface
- **Files changed**:
  - `backend/app/services/llm/claude.py` - ClaudeProvider class with generate() and stream() methods using Anthropic SDK
  - `backend/app/services/llm/__init__.py` - Updated to export ClaudeProvider
- **Learnings for future iterations:**
  - Anthropic SDK uses `anthropic.Anthropic()` for sync client and `anthropic.AsyncAnthropic()` for async client
  - Claude messages API: `messages.create()` for sync generation, `messages.stream()` async context manager for streaming
  - Streaming uses `stream.text_stream` async iterator to yield text chunks
  - Claude returns content as list of blocks - extract text with `[block.text for block in message.content if hasattr(block, "text")]`
  - Error handling: `AuthenticationError`, `RateLimitError`, `APITimeoutError`, `APIConnectionError`, `APIStatusError`
  - API key validation happens in constructor - raises LLMError early if not configured
  - Import ClaudeProvider: `from app.services.llm import ClaudeProvider`
---

## 2026-01-22 - US-037
- **What was implemented**: Created LLM factory with automatic fallback from Ollama to Claude
- **Files changed**:
  - `backend/app/services/llm/factory.py` - New factory module with get_provider() function and Ollama health check
  - `backend/app/services/llm/__init__.py` - Updated to export get_provider function
- **Learnings for future iterations:**
  - LLM factory uses `/api/tags` endpoint to check Ollama availability (not `/api/generate`)
  - Factory pattern: `get_provider()` returns a polymorphic LLMProvider instance
  - Health check has short timeout (5 seconds) to fail fast if Ollama is unavailable
  - Import factory: `from app.services.llm import get_provider`
  - Factory checks `settings.ANTHROPIC_API_KEY` before trying to instantiate ClaudeProvider
  - ClaudeProvider constructor raises LLMError if API key is missing, so factory catches that
---

## 2026-01-22 - US-038
- **What was implemented**: Created versioned prompt for extracting structured items from meeting notes
- **Files changed**:
  - `backend/prompts/extract_meeting_v1.txt` - New prompt template for LLM-based meeting extraction
- **Learnings for future iterations:**
  - Prompts go in `backend/prompts/` directory with version suffix (e.g., `extract_meeting_v1.txt`)
  - Prompt uses `{meeting_notes}` placeholder for input text injection
  - 9 extraction sections: problems, user_goals, functional_requirements, data_needs, constraints, non_goals, risks_assumptions, open_questions, action_items
  - JSON output format: `[{"section": "...", "content": "...", "source_quote": "..."}]`
  - source_quote must be exact text from meeting notes for traceability
  - Prompt handles edge cases: empty notes return `[]`, unclear content skipped, non-English preserved
---

## 2026-01-22 - US-039
- **What was implemented**: Created extractor service for processing meeting notes with LLM
- **Files changed**:
  - `backend/app/services/extractor.py` - New service with extract() function that processes meetings with LLM
  - `backend/app/services/__init__.py` - Updated exports to include extract, ExtractionError, and get_provider
- **Learnings for future iterations:**
  - Extractor service: `from app.services import extract, ExtractionError`
  - extract() function signature: `extract(meeting_id: UUID, db: Session) -> list[MeetingItem]`
  - ExtractionError is raised when extraction fails (meeting not found, LLM error, invalid JSON, etc.)
  - Prompt template loaded from `backend/prompts/extract_meeting_v1.txt` using Path
  - PROMPT_VERSION constant set to "extract_v1" for tracking which prompt version was used
  - LLM response parsing strips markdown code blocks (```json...```) before JSON parsing
  - JSON validation checks: must be array, each item must have section, content fields, section must be valid enum
  - Retry logic: max_attempts = LLM_MAX_RETRIES + 1 (default 2 attempts)
  - Meeting status transitions: pending -> processing -> processed/failed
  - SQLAlchemy Column type assignments need `# type: ignore[assignment]` for mypy with old-style Column definitions
---

## 2026-01-22 - US-040
- **What was implemented**: Created chunking service for splitting long meeting notes into manageable pieces
- **Files changed**:
  - `backend/app/services/chunker.py` - New service with chunk_text() function that splits text by paragraphs
  - `backend/app/services/__init__.py` - Updated exports to include chunk_text
- **Learnings for future iterations:**
  - Chunker service: `from app.services import chunk_text`
  - chunk_text() function signature: `chunk_text(text: str, max_chars: int = 4000) -> list[str]`
  - Token estimation: approximately 4 characters per token (max_chars=4000 ≈ 1000 tokens)
  - Splits text by double newlines (`\n\n`) to preserve paragraph boundaries
  - Tracks section headers (lines starting with `#`) and prepends to new chunks for context
  - Returns empty list for empty/whitespace-only input
  - Returns single-element list if text fits within max_chars
---

## 2026-01-22 - US-041
- **What was implemented**: Integrated chunking into extractor for handling long meeting notes
- **Files changed**:
  - `backend/app/services/extractor.py` - Modified extract() to chunk inputs > CHUNK_SIZE_CHARS, process separately, merge and deduplicate
- **Learnings for future iterations:**
  - Chunking is integrated into the main extract() function, not a separate service call
  - Uses `settings.CHUNK_SIZE_CHARS` (default 4000) as the threshold for chunking
  - Added `_extract_single_chunk()` helper function that handles retry logic for one chunk
  - Added `_deduplicate_items()` helper that removes exact (section, content) matches, keeping first occurrence
  - Chunk results are collected into `all_items_data` list, then deduplicated before creating MeetingItem records
  - Error handling wraps the entire extraction process - if any chunk fails, the meeting status is set to failed
---

## 2026-01-22 - US-042
- **What was implemented**: Added streaming extraction function for real-time item extraction feedback
- **Files changed**:
  - `backend/app/services/extractor.py` - Added `extract_stream()` async generator function and `_parse_streaming_json()` helper
  - `backend/app/services/__init__.py` - Updated exports to include `extract_stream`
- **Learnings for future iterations:**
  - `extract_stream()` is an async generator: `async for item in extract_stream(meeting_id, db): ...`
  - Streaming JSON parsing requires tracking brace counts and string escapes to find complete objects
  - `_parse_streaming_json()` handles partial JSON by finding complete `{...}` objects within accumulated text
  - Uses a `yielded_items` set to deduplicate on-the-fly as items are streamed
  - Same chunking logic as `extract()` - processes multiple chunks sequentially, yielding items from each
  - Import streaming extractor: `from app.services import extract_stream`
---

## 2026-01-22 - US-043
- **What was implemented**: Created SSE streaming endpoint for real-time extraction results
- **Files changed**:
  - `backend/app/routers/meetings.py` - Added GET /api/meetings/{job_id}/stream endpoint using sse-starlette
- **Learnings for future iterations:**
  - Use `EventSourceResponse` from `sse_starlette.sse` for SSE responses in FastAPI
  - SSE events use `{"event": "event_name", "data": json.dumps(data)}` format for sse-starlette
  - Check client disconnection with `await request.is_disconnected()` in the event generator
  - Import `Request` from fastapi to access `request.is_disconnected()`
  - sse-starlette was already in requirements.txt but needed to be installed in the environment
  - The endpoint wraps `extract_stream()` and emits status/item/complete/error events
---

## 2026-01-22 - US-044
- **What was implemented**: Created comprehensive tests for the extractor service with mocked LLM provider
- **Files changed**:
  - `backend/tests/test_extractor.py` - 12 tests covering extraction success, status transitions, and failure cases
- **Learnings for future iterations:**
  - Mock LLM provider by patching `get_provider` to return a custom class with `generate()` method
  - Use type casting helpers like `_get_project_id()` and `_get_meeting_uuid()` to satisfy mypy with SQLAlchemy model attributes
  - Test status transitions by checking `meeting.status`, `meeting.processed_at`, `meeting.failed_at`, `meeting.error_message`
  - Test retry behavior by creating a provider class that fails on first call and succeeds on second
  - Test all 9 section types to verify enum handling works correctly
  - Tests cover: successful extraction, status transitions, malformed JSON, missing fields, invalid sections, empty response, markdown code block stripping, order assignment, retry behavior
---

## 2026-01-22 - US-045
- **What was implemented**: Created comprehensive tests for the chunker service
- **Files changed**:
  - `backend/tests/test_chunker.py` - 17 tests organized in 5 classes covering all chunking scenarios
- **Learnings for future iterations:**
  - Chunker tests don't need database fixtures - they're pure unit tests
  - Test classes organize related tests: under limit, over limit, paragraph boundaries, section headers, edge cases
  - Key behaviors tested: empty input, exact limit, multiple chunks, paragraph boundary preservation, section header prepending
  - Tests verify that section headers are prepended to subsequent chunks for context continuity
  - Edge case: single very long paragraph is kept intact even if exceeding max_chars (can't split mid-paragraph)
---

## 2026-01-22 - US-046
- **What was implemented**: Created comprehensive tests for SSE streaming endpoint
- **Files changed**:
  - `backend/tests/test_streaming.py` - 15 tests organized in 5 classes covering status events, item events, complete events, error events, and meeting not found
- **Learnings for future iterations:**
  - SSE events are parsed from response text by splitting on newlines and extracting `event:` and `data:` lines
  - Test SSE endpoints with TestClient just like regular endpoints - response.text contains the SSE event stream
  - Mock async generators for testing extract_stream by defining async functions that yield dictionaries
  - Async generator mocks need an unreachable `yield` statement to satisfy Python's type checker
  - Test classes help organize related tests: status events, item events, complete events, error events, edge cases
  - SSE tests verify event order (status before items, items before complete), event content, and error handling
---
