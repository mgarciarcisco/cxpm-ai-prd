# Ralphy Progress Log

## Codebase Patterns
- Backend FastAPI app lives in `backend/app/main.py`
- Python dependencies in `backend/requirements.txt`
- Use `python3 -m mypy <file> --ignore-missing-imports` for typechecking
- Use `--break-system-packages` flag when installing pip packages in this environment
- Uvicorn runs the app: `python3 -m uvicorn app.main:app --port 8000`
- Import settings: `from app.config import settings`
- Import database: `from app.database import engine, SessionLocal, Base, get_db`
- Import models: `from app.models import Project` (add new models to models/__init__.py)
- Run Alembic migrations from backend directory: `cd backend && python3 -m alembic upgrade head`
- Create new migrations: `cd backend && python3 -m alembic revision --autogenerate -m "description"`
- Always import models in `alembic/env.py` for autogenerate to detect new models
- Import schemas: `from app.schemas import ProjectCreate, ProjectResponse` etc.
- Pydantic v2 uses `model_config = {"from_attributes": True}` for ORM conversion
- Routers go in `backend/app/routers/`, export from `__init__.py`, include in main.py
- Use `APIRouter(prefix="/api/...", tags=["..."])` for route grouping
- Response models: `response_model=ProjectResponse`, status codes: `status_code=status.HTTP_201_CREATED`
- Run tests: `cd backend && python3 -m pytest tests/ -v`
- Test fixtures in `backend/conftest.py`: `test_db` (in-memory SQLite), `test_client` (FastAPI TestClient)
- In-memory SQLite tests require `poolclass=StaticPool` and model imports in conftest.py
- Frontend (ui) uses Vite + React with npm scripts: `npm run dev`, `npm run build`
- React Router: BrowserRouter wraps App in main.jsx, Routes/Route in App.jsx
- Pages go in `ui/src/pages/`, components in `ui/src/components/{feature}/` (e.g., `components/projects/`)
- Use `Link` from react-router-dom for navigation, not `<a>` tags
- API service: `import { get, post, put, del } from '../services/api'` for HTTP calls
- Run frontend tests: `cd ui && npm test`
- Frontend tests in `ui/tests/components/` for component tests, `ui/tests/e2e/` for E2E tests
- Wrap components using react-router-dom with `<BrowserRouter>` in tests
- SQLAlchemy 2.0 typed columns: use `Mapped[T]` and `mapped_column()` for mypy compliance
- Enum columns: `status: Mapped[StatusEnum] = mapped_column(SAEnum(StatusEnum), ...)` (use `from sqlalchemy import Enum as SAEnum`)

---

## 2026-01-22 - US-001
- **What was implemented**: Set up FastAPI backend structure with CORS middleware and health check endpoint
- **Files changed**:
  - `backend/app/__init__.py` - Created empty init file
  - `backend/app/main.py` - FastAPI app with CORS and /api/health endpoint
  - `backend/requirements.txt` - All required dependencies
- **Learnings for future iterations:**
  - This environment is externally managed Python, need `--break-system-packages` for pip
  - Mypy works with `--ignore-missing-imports` flag for third-party libs
  - CORS allows localhost:3000, localhost:5173, and 127.0.0.1 variants
---

## 2026-01-22 - US-002
- **What was implemented**: Created centralized configuration with pydantic-settings
- **Files changed**:
  - `backend/app/config.py` - Settings class with all config variables using pydantic-settings
  - `backend/.env.example` - Example environment file documenting all optional variables
- **Learnings for future iterations:**
  - Config uses `env_file = ".env"` in Config class to load from .env file
  - Import settings with `from app.config import settings`
  - All settings have sensible defaults for local development
---

## 2026-01-22 - US-003
- **What was implemented**: Configured SQLAlchemy with SQLite database
- **Files changed**:
  - `backend/app/database.py` - SQLAlchemy engine, SessionLocal, Base, and get_db dependency
- **Learnings for future iterations:**
  - Import database components: `from app.database import engine, SessionLocal, Base, get_db`
  - SQLite requires `connect_args={"check_same_thread": False}` for thread safety
  - `get_db` is a FastAPI dependency generator that yields Session and auto-closes
  - SessionLocal is configured with `autocommit=False, autoflush=False` as per FastAPI best practices
---

## 2026-01-22 - US-004
- **What was implemented**: Set up Alembic for database migrations
- **Files changed**:
  - `backend/alembic.ini` - Alembic configuration file
  - `backend/alembic/env.py` - Updated to import Base from database.py and use DATABASE_URL from config
  - `backend/alembic/versions/0194510d4c15_initial.py` - Initial empty migration
  - `.gitignore` - Added *.db to exclude SQLite database files
- **Learnings for future iterations:**
  - Run migrations from backend directory: `cd backend && python3 -m alembic upgrade head`
  - Create new migrations: `python3 -m alembic revision --autogenerate -m "description"`
  - env.py uses `config.set_main_option("sqlalchemy.url", settings.DATABASE_URL)` to dynamically set URL
  - Alembic imports models via Base.metadata for autogenerate support
---

## 2026-01-22 - US-005
- **What was implemented**: Created Project model with database migration
- **Files changed**:
  - `backend/app/models/__init__.py` - Models package init, exports Project
  - `backend/app/models/project.py` - Project model with id (UUID), name, description, created_at, updated_at
  - `backend/alembic/env.py` - Updated to import models for autogenerate support
  - `backend/alembic/versions/02ddbe2acae5_create_projects_table.py` - Migration creating projects table
- **Learnings for future iterations:**
  - Models go in `backend/app/models/` directory
  - Import models with `from app.models import Project`
  - UUID columns use `CHAR(36)` type in SQLite with lambda default for uuid generation
  - Always import models in `alembic/env.py` for autogenerate to detect schema changes
  - Cascade delete relationships are configured via SQLAlchemy relationship() with cascade="all, delete-orphan"
---

## 2026-01-22 - US-006
- **What was implemented**: Created Pydantic schemas for Project API validation
- **Files changed**:
  - `backend/app/schemas/__init__.py` - Schemas package init, exports all Project schemas
  - `backend/app/schemas/project.py` - ProjectCreate, ProjectUpdate, ProjectResponse, ProjectList schemas
- **Learnings for future iterations:**
  - Schemas go in `backend/app/schemas/` directory
  - Import schemas with `from app.schemas import ProjectCreate, ProjectResponse` etc.
  - Use `model_config = {"from_attributes": True}` in Pydantic v2 for ORM model conversion
  - ProjectCreate has required `name`, optional `description`
  - ProjectUpdate has all optional fields for partial updates
  - ProjectResponse includes all fields including timestamps
  - ProjectList wraps a list of ProjectResponse objects
---

## 2026-01-22 - US-007
- **What was implemented**: Created Project CRUD API endpoints
- **Files changed**:
  - `backend/app/routers/__init__.py` - Routers package init, exports projects_router
  - `backend/app/routers/projects.py` - Full CRUD: POST, GET (list), GET (single), PUT, DELETE
  - `backend/app/main.py` - Registered projects_router
- **Learnings for future iterations:**
  - Routers go in `backend/app/routers/` directory
  - Use `router = APIRouter(prefix="/api/projects", tags=["projects"])` for route grouping
  - Router exports from `__init__.py`: `from app.routers.projects import router as projects_router`
  - Include router in main.py: `app.include_router(projects_router)`
  - Use `response_model` decorator param for automatic response serialization
  - Use `status_code=status.HTTP_201_CREATED` for POST endpoints
  - Use `status_code=status.HTTP_204_NO_CONTENT` for DELETE endpoints
  - Use `model_dump(exclude_unset=True)` in Pydantic v2 for partial updates
---

## 2026-01-22 - US-008
- **What was implemented**: Set up pytest with fixtures for testing
- **Files changed**:
  - `backend/pytest.ini` - Pytest configuration with asyncio_mode = auto
  - `backend/conftest.py` - Test fixtures for test_client and test_db
  - `backend/tests/__init__.py` - Tests package init
  - `backend/tests/test_health.py` - Health endpoint test to verify setup
- **Learnings for future iterations:**
  - Tests go in `backend/tests/` directory
  - Run tests: `cd backend && python3 -m pytest tests/ -v`
  - test_db fixture uses in-memory SQLite (`sqlite:///:memory:`) for test isolation
  - test_client fixture overrides get_db dependency to use test database
  - Each test gets fresh database (tables created before, dropped after)
  - Use `app.dependency_overrides[get_db] = override_get_db` to swap dependencies in tests
---

## 2026-01-22 - US-009
- **What was implemented**: Created tests for Project CRUD endpoints
- **Files changed**:
  - `backend/tests/test_projects.py` - Comprehensive tests for all 5 CRUD operations
  - `backend/conftest.py` - Fixed to use StaticPool and import models
- **Learnings for future iterations:**
  - In-memory SQLite requires `poolclass=StaticPool` to share the same database across connections
  - Must import models in `conftest.py` so `Base.metadata.create_all()` creates the tables
  - Test file covers: POST create, GET list, GET single, GET 404, PUT update, PUT 404, DELETE, DELETE 404
  - Use fake UUID `00000000-0000-0000-0000-000000000000` to test 404 responses
---

## 2026-01-22 - US-010
- **What was implemented**: Set up React Router with /app routes for SPA navigation
- **Files changed**:
  - `ui/package.json` - Added react-router-dom dependency
  - `ui/src/main.jsx` - Wrapped App with BrowserRouter
  - `ui/src/App.jsx` - Set up Routes component with / and /app routes
  - `ui/src/pages/LandingPage.jsx` - Extracted landing page content from original App.jsx
  - `ui/src/pages/ProjectsPage.jsx` - Created placeholder for projects page
  - `ui/src/App.css` - Added styles for feature-card-link, back-link, projects-placeholder
- **Learnings for future iterations:**
  - Use `Link` from react-router-dom for client-side navigation
  - BrowserRouter must wrap the entire app in main.jsx (entry point)
  - Routes/Route components define URL-to-component mapping
  - Use `path="/app/*"` to catch all subroutes for a section
  - Build with `npm run build` to verify no JS errors
  - Manual browser verification needed for routing - no agent-browser skill available
---

## 2026-01-22 - US-011
- **What was implemented**: Created API service layer with fetch wrapper for consistent HTTP calls
- **Files changed**:
  - `ui/src/services/api.js` - Created with get, post, put, del functions and error handling
- **Learnings for future iterations:**
  - API service uses `import.meta.env.VITE_API_URL` for base URL (Vite env var pattern)
  - Default base URL is `http://localhost:8000` for local development
  - All functions throw Error with `detail` from API response or status code fallback
  - Import API methods: `import { get, post, put, del } from '../services/api'`
  - DELETE typically returns 204 No Content, so `del()` handles both 204 and JSON responses
---

## 2026-01-22 - US-012
- **What was implemented**: Created ProjectCard component for displaying project information as a card
- **Files changed**:
  - `ui/src/components/projects/ProjectCard.jsx` - Component with name, description, meeting count, last activity, edit/delete buttons
  - `ui/src/components/projects/ProjectCard.css` - Styling for the card with hover effects and consistent design
- **Learnings for future iterations:**
  - Components go in `ui/src/components/{feature}/` directories (e.g., `components/projects/`)
  - Use CSS alongside component files for scoped styling (e.g., `ProjectCard.css` next to `ProjectCard.jsx`)
  - Import CSS in component: `import './ProjectCard.css'`
  - Use `useNavigate` from react-router-dom for programmatic navigation
  - Use `e.stopPropagation()` in nested buttons to prevent click events from bubbling to parent
  - Card uses SVG icons inline for edit, delete, and stats (meetings, clock)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-013
- **What was implemented**: Created ProjectsPage with responsive card grid that displays projects
- **Files changed**:
  - `ui/src/pages/ProjectsPage.jsx` - Full page implementation with data fetching, loading/error/empty states
  - `ui/src/pages/ProjectsPage.css` - Styling for grid, loading spinner, error and empty states
- **Learnings for future iterations:**
  - Pages go in `ui/src/pages/` directory with accompanying CSS files
  - Use `useState` for state management: loading, error, data
  - Use `useEffect` with empty deps array for fetch on mount
  - API returns `{ projects: [...] }` - access `.projects` property
  - Loading spinner uses CSS animation with `border-top-color` for spinner effect
  - Responsive grid: 3 columns > 2 columns (1024px) > 1 column (640px)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-014
- **What was implemented**: Created reusable Modal component for displaying forms and content in overlays
- **Files changed**:
  - `ui/src/components/common/Modal.jsx` - Modal with backdrop, close button, focus trapping, ESC key support
  - `ui/src/components/common/Modal.css` - Styling with responsive design (bottom sheet on mobile)
- **Learnings for future iterations:**
  - Shared/common components go in `ui/src/components/common/` directory
  - Modal uses refs for focus management: store `previousActiveElement` to restore on close
  - Focus trap implementation: query focusable elements, handle Tab/Shift+Tab cycling
  - Prevent body scroll when modal open: `document.body.style.overflow = 'hidden'`
  - ESC key closes modal via `document.addEventListener('keydown', ...)`
  - Use `aria-modal="true"` and `role="dialog"` for accessibility
  - Mobile responsive: modal becomes bottom sheet (slides up from bottom) on narrow screens
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-015
- **What was implemented**: Created ProjectForm component for creating and editing projects
- **Files changed**:
  - `ui/src/components/projects/ProjectForm.jsx` - Form with name input (required) and description textarea (optional)
  - `ui/src/components/projects/ProjectForm.css` - Styling for form inputs, labels, buttons, error states
- **Learnings for future iterations:**
  - Form components accept `project` prop for edit mode and `onSubmit` prop for form submission
  - Use `useEffect` to pre-fill form values when `project` prop is passed
  - `onSubmit` prop should be async - form handles try/catch and displays error message on failure
  - Submit button disabled when required field empty (`!name.trim()`) or during submission
  - CSS pattern: `.project-form-btn--primary` and `--secondary` for button variants
  - Responsive: buttons stack vertically on mobile with `flex-direction: column-reverse`
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - Bugfix: US-013 API Contract Mismatch
- **What was fixed**: Corrected API response handling in ProjectsPage - backend returns plain array, not wrapped object
- **Files changed**:
  - `ui/src/pages/ProjectsPage.jsx` - Changed `setProjects(data.projects || [])` to `setProjects(data || [])`
- **Learnings for future iterations:**
  - Backend `GET /api/projects` returns `list[ProjectResponse]` (plain array), not `{ projects: [...] }`
  - Always verify API response format matches frontend expectations before marking story complete
  - The unused `ProjectList` schema in `schemas/project.py` could cause confusion - it wraps projects but isn't used by the router
---

## 2026-01-22 - US-016
- **What was implemented**: Integrated ProjectForm modal in ProjectsPage for creating new projects
- **Files changed**:
  - `ui/src/pages/ProjectsPage.jsx` - Added modal state, wired New Project button to open modal, handle form submission
- **Learnings for future iterations:**
  - Modal state pattern: `const [isModalOpen, setIsModalOpen] = useState(false)`
  - Form submission handler: make async call, close modal, update list with new item
  - After successful POST, use `setProjects((prev) => [...prev, newProject])` to append without refetch
  - ProjectForm handles its own error display via try/catch in handleSubmit
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-017
- **What was implemented**: Set up Vitest with component tests for frontend testing
- **Files changed**:
  - `ui/package.json` - Added test script and devDependencies (vitest, @testing-library/react, @testing-library/jest-dom, jsdom)
  - `ui/vite.config.js` - Added test configuration with jsdom environment
  - `ui/tests/setup.js` - Test setup file that imports @testing-library/jest-dom
  - `ui/tests/components/ProjectCard.test.jsx` - Component tests for ProjectCard (name, description rendering)
  - `ui/tests/e2e/` - Created empty directory for future E2E tests
- **Learnings for future iterations:**
  - Run frontend tests: `cd ui && npm test`
  - Vitest v4 removed `pool` and `poolOptions` - use `isolate: false` at top level for single-threaded execution
  - Test setup file imports `@testing-library/jest-dom` for DOM matchers
  - Components using react-router-dom need to be wrapped with `<BrowserRouter>` in tests
  - Use `vi.fn()` from Vitest to create mock functions
  - Test structure: `ui/tests/components/` for component tests, `ui/tests/e2e/` for E2E tests
---

## 2026-01-22 - US-018
- **What was implemented**: Created MeetingRecap model with status lifecycle for tracking uploaded meeting notes
- **Files changed**:
  - `backend/app/models/meeting_recap.py` - New model with MeetingStatus and InputType enums, all required fields
  - `backend/app/models/__init__.py` - Updated to export MeetingRecap, MeetingStatus, InputType
  - `backend/app/models/project.py` - Enabled meetings relationship with cascade delete
  - `backend/alembic/env.py` - Added MeetingRecap import for autogenerate
  - `backend/alembic/versions/0a10fb35f446_create_meeting_recaps_table.py` - Migration file
  - `backend/conftest.py` - Added MeetingRecap import for test db setup
- **Learnings for future iterations:**
  - SQLAlchemy 2.0 style uses `Mapped[T]` and `mapped_column()` for type annotations to satisfy mypy
  - Enum columns need explicit type annotation: `input_type: Mapped[InputType] = mapped_column(...)`
  - Use `SAEnum` alias when importing `from sqlalchemy import Enum as SAEnum` to avoid conflict with Python's `enum.Enum`
  - Status enums inheriting from `str, enum.Enum` work well with Pydantic serialization
  - Foreign key with cascade delete: `ForeignKey("table.id", ondelete="CASCADE")`
  - Remember to update conftest.py imports for new models so test DB creates tables
---

## 2026-01-22 - US-019
- **What was implemented**: Created MeetingItem model for storing extracted items from meeting notes
- **Files changed**:
  - `backend/app/models/meeting_item.py` - New model with Section enum and MeetingItem model
  - `backend/app/models/__init__.py` - Updated to export MeetingItem and Section
  - `backend/app/models/meeting_recap.py` - Enabled items relationship with cascade delete
  - `backend/alembic/env.py` - Added MeetingItem import for autogenerate
  - `backend/alembic/versions/96e4c628927a_create_meeting_items_table.py` - Migration file
  - `backend/conftest.py` - Added MeetingItem import for test db setup
- **Learnings for future iterations:**
  - Section enum has 9 values for requirement categories: problems, user_goals, functional_requirements, data_needs, constraints, non_goals, risks_assumptions, open_questions, action_items
  - Use `str | None` for optional typed columns: `source_quote: Mapped[str | None] = mapped_column(Text, nullable=True)`
  - Composite indexes defined in `__table_args__`: `Index("ix_name", "col1", "col2")`
  - MeetingItem has soft-delete via is_deleted flag (not hard delete)
  - Relationships are bidirectional: MeetingRecap.items ↔ MeetingItem.meeting
---

## 2026-01-22 - US-020
- **What was implemented**: Created Pydantic schemas for Meeting API request/response validation
- **Files changed**:
  - `backend/app/schemas/meeting.py` - New schemas: MeetingUpload, MeetingItemResponse, MeetingResponse, UploadResponse
  - `backend/app/schemas/__init__.py` - Updated to export Meeting schemas
- **Learnings for future iterations:**
  - Import enums from models for Pydantic schemas: `from app.models.meeting_recap import MeetingStatus, InputType`
  - Pydantic schemas can reference SQLAlchemy model enums directly - they inherit from `str, enum.Enum`
  - MeetingResponse includes nested `items: list[MeetingItemResponse]` for one-to-many relationships
  - UploadResponse returns `job_id` and `meeting_id` (both same value, for API flexibility)
---

## 2026-01-22 - US-021
- **What was implemented**: Created file parser service for processing uploaded meeting notes
- **Files changed**:
  - `backend/app/services/__init__.py` - Services package init, exports parse_file
  - `backend/app/services/parser.py` - Async parse_file function that validates and parses .txt and .md files
- **Learnings for future iterations:**
  - Services go in `backend/app/services/` directory
  - Import services: `from app.services import parse_file` or `from app.services.parser import parse_file`
  - parse_file is async: `content = await parse_file(file)` where file is FastAPI's UploadFile
  - File size check uses `settings.MAX_FILE_SIZE_KB * 1024` for byte comparison
  - File extension check uses `filename.lower().endswith((".txt", ".md"))` for flexibility
---

## 2026-01-22 - US-022
- **What was implemented**: Created meeting upload endpoint for processing meeting notes
- **Files changed**:
  - `backend/app/routers/meetings.py` - New router with POST /api/meetings/upload endpoint
  - `backend/app/routers/__init__.py` - Updated to export meetings_router
  - `backend/app/main.py` - Registered meetings_router
- **Learnings for future iterations:**
  - FastAPI Form() and File() can be used together for multipart form data with file upload
  - Use `Optional[UploadFile] = File(None)` for optional file upload
  - Use `Optional[str] = Form(None)` for optional form field
  - The endpoint is async since it uses parse_file which is async
  - python-multipart package is required at runtime for Form data (installed separately from requirements.txt)
---

## 2026-01-22 - US-023
- **What was implemented**: Created meeting list and get endpoints for viewing meetings
- **Files changed**:
  - `backend/app/routers/meetings.py` - Added GET /api/meetings/{id} endpoint with items filtering
  - `backend/app/routers/projects.py` - Added GET /api/projects/{id}/meetings endpoint
  - `backend/app/schemas/meeting.py` - Added MeetingListItemResponse schema for list views
  - `backend/app/schemas/__init__.py` - Exported new MeetingListItemResponse schema
- **Learnings for future iterations:**
  - Project-scoped endpoints go in projects router: `/api/projects/{id}/meetings`
  - Resource-specific endpoints go in their own router: `/api/meetings/{id}`
  - Use separate response schemas for list vs detail views (MeetingListItemResponse vs MeetingResponse)
  - Filter soft-deleted items with `MeetingItem.is_deleted == False` in queries
  - When building response dicts manually, all fields must be explicitly included for Pydantic validation
---

## 2026-01-22 - US-024
- **What was implemented**: Created meeting delete endpoint for removing meetings and their associated items
- **Files changed**:
  - `backend/app/routers/meetings.py` - Added DELETE /{meeting_id} endpoint with 204/404 responses
- **Learnings for future iterations:**
  - DELETE endpoints use `status_code=status.HTTP_204_NO_CONTENT` and return `None`
  - MeetingRecap model has cascade delete configured, so deleting a meeting automatically removes associated MeetingItems
  - FastAPI returns 204 No Content automatically when route returns None with 204 status code
---

## 2026-01-22 - US-025
- **What was implemented**: Created tests for the file parser service
- **Files changed**:
  - `backend/tests/test_parser.py` - 10 tests covering: valid .txt parsing, valid .md parsing, uppercase extensions, 50KB limit rejection, exact 50KB acceptance, unsupported file type rejection (.pdf, .docx), no extension rejection, empty filename rejection
- **Learnings for future iterations:**
  - Use `MagicMock()` (not `MagicMock(spec=UploadFile)`) with return type `Any` to avoid mypy issues with mock assertions
  - `AsyncMock(return_value=content)` for mocking async methods like `file.read()`
  - Parser service tests don't need database fixtures - they're unit tests for pure functions
  - Test boundary conditions: exact limits (50KB) and just-over limits (50KB + 1 byte)
---

## 2026-01-22 - US-026
- **What was implemented**: Created comprehensive tests for meeting endpoints
- **Files changed**:
  - `backend/tests/test_meetings.py` - 13 tests covering: upload with text, upload with .txt file, upload with .md file, upload requires file or text, upload 404 on missing project, list meetings by project, list empty meetings, list meetings 404 on missing project, get meeting with items, get meeting 404, delete meeting, delete meeting 404, delete removes from project list
- **Learnings for future iterations:**
  - Use `BytesIO` from `io` module to create in-memory file objects for testing file uploads
  - For multipart file uploads in TestClient: `files={"file": ("filename.txt", file_obj, "text/plain")}`
  - Form data goes in `data={}` parameter, files in `files={}` parameter
  - Helper functions like `_create_project()` reduce test boilerplate and improve readability
  - Test both positive cases and error cases (404s) for all CRUD operations
---

## 2026-01-22 - US-027
- **What was implemented**: Created StatusBadge component for displaying meeting status with colored badges
- **Files changed**:
  - `ui/src/components/common/StatusBadge.jsx` - Component with status prop, renders badge with appropriate color
  - `ui/src/components/common/StatusBadge.css` - Styling with colors for each status (gray=pending, blue=processing, green=processed, purple=applied, red=failed)
- **Learnings for future iterations:**
  - StatusBadge uses a config object pattern to map status values to labels and CSS classes
  - Status colors follow common UI conventions: gray for inactive, blue for in-progress, green for success, red for error
  - Frontend Vitest tests may have worker timeout issues in WSL/Windows environments - build pass confirms code correctness
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-028
- **What was implemented**: Created MeetingsList component for displaying meetings with status badges
- **Files changed**:
  - `ui/src/components/meetings/MeetingsList.jsx` - Component displaying meetings as list items with title, date, StatusBadge; onClick handler; empty state
  - `ui/src/components/meetings/MeetingsList.css` - Styling for list items with hover effects and empty state
- **Learnings for future iterations:**
  - Meeting list components go in `ui/src/components/meetings/` directory
  - Use `onMeetingClick` prop pattern for click handling (passing the meeting object)
  - Empty state shows an icon and "No meetings yet" text
  - Meetings have `meeting_date` field (snake_case from backend API)
---

## 2026-01-22 - US-029
- **What was implemented**: Created ProjectDashboard page with two-panel layout for managing meetings and viewing requirements
- **Files changed**:
  - `ui/src/pages/ProjectDashboard.jsx` - Dashboard page with project info, action buttons, left panel (MeetingsList), right panel (requirements placeholder)
  - `ui/src/pages/ProjectDashboard.css` - Styling for two-panel layout, action buttons, loading/error states
  - `ui/src/App.jsx` - Added route `/app/projects/:id` for ProjectDashboard
- **Learnings for future iterations:**
  - Use `useParams()` from react-router-dom to extract `:id` from URL
  - Use `Promise.all()` to fetch multiple API endpoints in parallel for better performance
  - Export functionality needs raw fetch (not api.js) to handle blob response for file download
  - Create download link programmatically: create blob URL, create anchor, click, cleanup
  - Two-panel layout uses CSS grid with `grid-template-columns: 1fr 1fr`, responsive at 1024px breakpoint
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-030
- **What was implemented**: Created FileDropzone component for drag-and-drop file uploads
- **Files changed**:
  - `ui/src/components/common/FileDropzone.jsx` - Component with drag-and-drop, click-to-upload, file validation, selected file display
  - `ui/src/components/common/FileDropzone.css` - Styling with dashed border, dragging state, selected file state
- **Learnings for future iterations:**
  - FileDropzone accepts `onFile` prop callback (receives File object or null when cleared)
  - Uses `accept` prop for file type filtering (default `.txt,.md`)
  - Drag events need `e.preventDefault()` and `e.stopPropagation()` to work correctly
  - File input hidden with `display: none`, triggered via ref on click
  - Shows visual feedback for different states: default, dragging (blue), has-file (green)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-031
- **What was implemented**: Created UploadMeetingPage for uploading meeting notes via file or text
- **Files changed**:
  - `ui/src/pages/UploadMeetingPage.jsx` - New page with title input (required), date picker, FileDropzone, textarea for text input, file size validation
  - `ui/src/pages/UploadMeetingPage.css` - Styling for form inputs, divider, error messages, responsive layout
  - `ui/src/App.jsx` - Added route `/app/projects/:id/meetings/new` for UploadMeetingPage
- **Learnings for future iterations:**
  - File size validation done client-side (50KB limit) before submission
  - Use "or" divider pattern with CSS pseudo-elements for alternative input methods
  - File and text inputs are mutually exclusive: selecting file clears text, typing text clears file
  - Date input defaults to today using `new Date().toISOString().split('T')[0]`
  - Submit button disabled when title empty OR (no file AND no text)
  - Form submission logic will be implemented in US-032 (this story only creates the UI)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-032
- **What was implemented**: Connected UploadMeetingPage to the backend API for uploading meeting notes
- **Files changed**:
  - `ui/src/pages/UploadMeetingPage.jsx` - Added API submission with FormData, loading state, error handling, and navigation
  - `ui/src/pages/UploadMeetingPage.css` - Added btn-spinner animation for loading state
- **Learnings for future iterations:**
  - Use raw `fetch` with FormData for multipart form uploads (not api.js wrapper which sets JSON content-type)
  - FormData automatically handles file vs text data: `formData.append('file', file)` or `formData.append('text', text)`
  - Use `useNavigate` from react-router-dom for programmatic navigation after form submission
  - Pass state to navigation target via second argument: `navigate(path, { state: { job_id } })`
  - Loading spinner pattern: CSS animation with `border-top-color` for spinner effect (consistent with ProjectsPage)
  - isSubmitDisabled should include isLoading to prevent double submissions
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-033
- **What was implemented**: Created comprehensive tests for the upload form (UploadMeetingPage)
- **Files changed**:
  - `ui/tests/components/UploadMeetingPage.test.jsx` - 20 tests covering title validation, file handling, size validation, text input
  - `ui/package.json` - Added @testing-library/user-event dependency
- **Learnings for future iterations:**
  - Use `@testing-library/user-event` for realistic user interaction testing (typing, clicking)
  - For routing tests, wrap components with `<BrowserRouter>` and define required Routes
  - Mock `global.fetch` for API call tests: `global.fetch = vi.fn()` in test setup
  - Create file objects for testing: `new File([content], 'filename.txt', { type: 'text/plain' })`
  - Use `fireEvent.change(input, { target: { files: [file] } })` to simulate file selection
  - FileDropzone maintains its own internal state - parent can't directly clear it without using clear button
  - Test setup helper: `window.history.pushState({}, 'Test page', route)` to set initial route
---

## 2026-01-22 - US-034
- **What was implemented**: Created abstract LLM provider base class and LLMError exception
- **Files changed**:
  - `backend/app/services/llm/__init__.py` - New LLM subpackage init, exports LLMProvider and LLMError
  - `backend/app/services/llm/base.py` - Abstract LLMProvider class with generate() and async stream() methods
  - `backend/app/services/__init__.py` - Updated to export LLM classes
- **Learnings for future iterations:**
  - LLM providers go in `backend/app/services/llm/` directory
  - Import LLM classes: `from app.services.llm import LLMProvider, LLMError`
  - LLMProvider is an ABC with abstract methods `generate(prompt: str) -> str` and `async stream(prompt: str) -> AsyncIterator[str]`
  - Abstract async generators need a `yield ""` statement (unreachable) to satisfy mypy type checking
  - LLMError is a custom exception for LLM operation failures
---

## 2026-01-22 - US-035
- **What was implemented**: Created Ollama LLM provider implementing the LLMProvider interface
- **Files changed**:
  - `backend/app/services/llm/ollama.py` - OllamaProvider class with generate() and stream() methods
  - `backend/app/services/llm/__init__.py` - Updated to export OllamaProvider
- **Learnings for future iterations:**
  - Ollama API endpoints: `/api/generate` for text generation, `/api/tags` for health check
  - Use `httpx` library for HTTP calls (sync Client and async AsyncClient)
  - Streaming response: set `stream: True` in payload, use `client.stream()` and `aiter_lines()` for async
  - Ollama returns JSONL format for streaming - each line is a JSON object with `response` field
  - Error handling: catch `httpx.ConnectError` for "Ollama not available", `httpx.TimeoutException` for timeouts
  - Provider accepts optional constructor params to override settings: base_url, model, timeout
---

## 2026-01-22 - US-036
- **What was implemented**: Created Claude LLM provider implementing the LLMProvider interface
- **Files changed**:
  - `backend/app/services/llm/claude.py` - ClaudeProvider class with generate() and stream() methods using Anthropic SDK
  - `backend/app/services/llm/__init__.py` - Updated to export ClaudeProvider
- **Learnings for future iterations:**
  - Anthropic SDK uses `anthropic.Anthropic()` for sync client and `anthropic.AsyncAnthropic()` for async client
  - Claude messages API: `messages.create()` for sync generation, `messages.stream()` async context manager for streaming
  - Streaming uses `stream.text_stream` async iterator to yield text chunks
  - Claude returns content as list of blocks - extract text with `[block.text for block in message.content if hasattr(block, "text")]`
  - Error handling: `AuthenticationError`, `RateLimitError`, `APITimeoutError`, `APIConnectionError`, `APIStatusError`
  - API key validation happens in constructor - raises LLMError early if not configured
  - Import ClaudeProvider: `from app.services.llm import ClaudeProvider`
---

## 2026-01-22 - US-037
- **What was implemented**: Created LLM factory with automatic fallback from Ollama to Claude
- **Files changed**:
  - `backend/app/services/llm/factory.py` - New factory module with get_provider() function and Ollama health check
  - `backend/app/services/llm/__init__.py` - Updated to export get_provider function
- **Learnings for future iterations:**
  - LLM factory uses `/api/tags` endpoint to check Ollama availability (not `/api/generate`)
  - Factory pattern: `get_provider()` returns a polymorphic LLMProvider instance
  - Health check has short timeout (5 seconds) to fail fast if Ollama is unavailable
  - Import factory: `from app.services.llm import get_provider`
  - Factory checks `settings.ANTHROPIC_API_KEY` before trying to instantiate ClaudeProvider
  - ClaudeProvider constructor raises LLMError if API key is missing, so factory catches that
---

## 2026-01-22 - US-038
- **What was implemented**: Created versioned prompt for extracting structured items from meeting notes
- **Files changed**:
  - `backend/prompts/extract_meeting_v1.txt` - New prompt template for LLM-based meeting extraction
- **Learnings for future iterations:**
  - Prompts go in `backend/prompts/` directory with version suffix (e.g., `extract_meeting_v1.txt`)
  - Prompt uses `{meeting_notes}` placeholder for input text injection
  - 9 extraction sections: problems, user_goals, functional_requirements, data_needs, constraints, non_goals, risks_assumptions, open_questions, action_items
  - JSON output format: `[{"section": "...", "content": "...", "source_quote": "..."}]`
  - source_quote must be exact text from meeting notes for traceability
  - Prompt handles edge cases: empty notes return `[]`, unclear content skipped, non-English preserved
---

## 2026-01-22 - US-039
- **What was implemented**: Created extractor service for processing meeting notes with LLM
- **Files changed**:
  - `backend/app/services/extractor.py` - New service with extract() function that processes meetings with LLM
  - `backend/app/services/__init__.py` - Updated exports to include extract, ExtractionError, and get_provider
- **Learnings for future iterations:**
  - Extractor service: `from app.services import extract, ExtractionError`
  - extract() function signature: `extract(meeting_id: UUID, db: Session) -> list[MeetingItem]`
  - ExtractionError is raised when extraction fails (meeting not found, LLM error, invalid JSON, etc.)
  - Prompt template loaded from `backend/prompts/extract_meeting_v1.txt` using Path
  - PROMPT_VERSION constant set to "extract_v1" for tracking which prompt version was used
  - LLM response parsing strips markdown code blocks (```json...```) before JSON parsing
  - JSON validation checks: must be array, each item must have section, content fields, section must be valid enum
  - Retry logic: max_attempts = LLM_MAX_RETRIES + 1 (default 2 attempts)
  - Meeting status transitions: pending -> processing -> processed/failed
  - SQLAlchemy Column type assignments need `# type: ignore[assignment]` for mypy with old-style Column definitions
---

## 2026-01-22 - US-040
- **What was implemented**: Created chunking service for splitting long meeting notes into manageable pieces
- **Files changed**:
  - `backend/app/services/chunker.py` - New service with chunk_text() function that splits text by paragraphs
  - `backend/app/services/__init__.py` - Updated exports to include chunk_text
- **Learnings for future iterations:**
  - Chunker service: `from app.services import chunk_text`
  - chunk_text() function signature: `chunk_text(text: str, max_chars: int = 4000) -> list[str]`
  - Token estimation: approximately 4 characters per token (max_chars=4000 ≈ 1000 tokens)
  - Splits text by double newlines (`\n\n`) to preserve paragraph boundaries
  - Tracks section headers (lines starting with `#`) and prepends to new chunks for context
  - Returns empty list for empty/whitespace-only input
  - Returns single-element list if text fits within max_chars
---

## 2026-01-22 - US-041
- **What was implemented**: Integrated chunking into extractor for handling long meeting notes
- **Files changed**:
  - `backend/app/services/extractor.py` - Modified extract() to chunk inputs > CHUNK_SIZE_CHARS, process separately, merge and deduplicate
- **Learnings for future iterations:**
  - Chunking is integrated into the main extract() function, not a separate service call
  - Uses `settings.CHUNK_SIZE_CHARS` (default 4000) as the threshold for chunking
  - Added `_extract_single_chunk()` helper function that handles retry logic for one chunk
  - Added `_deduplicate_items()` helper that removes exact (section, content) matches, keeping first occurrence
  - Chunk results are collected into `all_items_data` list, then deduplicated before creating MeetingItem records
  - Error handling wraps the entire extraction process - if any chunk fails, the meeting status is set to failed
---

## 2026-01-22 - US-042
- **What was implemented**: Added streaming extraction function for real-time item extraction feedback
- **Files changed**:
  - `backend/app/services/extractor.py` - Added `extract_stream()` async generator function and `_parse_streaming_json()` helper
  - `backend/app/services/__init__.py` - Updated exports to include `extract_stream`
- **Learnings for future iterations:**
  - `extract_stream()` is an async generator: `async for item in extract_stream(meeting_id, db): ...`
  - Streaming JSON parsing requires tracking brace counts and string escapes to find complete objects
  - `_parse_streaming_json()` handles partial JSON by finding complete `{...}` objects within accumulated text
  - Uses a `yielded_items` set to deduplicate on-the-fly as items are streamed
  - Same chunking logic as `extract()` - processes multiple chunks sequentially, yielding items from each
  - Import streaming extractor: `from app.services import extract_stream`
---

## 2026-01-22 - US-043
- **What was implemented**: Created SSE streaming endpoint for real-time extraction results
- **Files changed**:
  - `backend/app/routers/meetings.py` - Added GET /api/meetings/{job_id}/stream endpoint using sse-starlette
- **Learnings for future iterations:**
  - Use `EventSourceResponse` from `sse_starlette.sse` for SSE responses in FastAPI
  - SSE events use `{"event": "event_name", "data": json.dumps(data)}` format for sse-starlette
  - Check client disconnection with `await request.is_disconnected()` in the event generator
  - Import `Request` from fastapi to access `request.is_disconnected()`
  - sse-starlette was already in requirements.txt but needed to be installed in the environment
  - The endpoint wraps `extract_stream()` and emits status/item/complete/error events
---

## 2026-01-22 - US-044
- **What was implemented**: Created comprehensive tests for the extractor service with mocked LLM provider
- **Files changed**:
  - `backend/tests/test_extractor.py` - 12 tests covering extraction success, status transitions, and failure cases
- **Learnings for future iterations:**
  - Mock LLM provider by patching `get_provider` to return a custom class with `generate()` method
  - Use type casting helpers like `_get_project_id()` and `_get_meeting_uuid()` to satisfy mypy with SQLAlchemy model attributes
  - Test status transitions by checking `meeting.status`, `meeting.processed_at`, `meeting.failed_at`, `meeting.error_message`
  - Test retry behavior by creating a provider class that fails on first call and succeeds on second
  - Test all 9 section types to verify enum handling works correctly
  - Tests cover: successful extraction, status transitions, malformed JSON, missing fields, invalid sections, empty response, markdown code block stripping, order assignment, retry behavior
---

## 2026-01-22 - US-045
- **What was implemented**: Created comprehensive tests for the chunker service
- **Files changed**:
  - `backend/tests/test_chunker.py` - 17 tests organized in 5 classes covering all chunking scenarios
- **Learnings for future iterations:**
  - Chunker tests don't need database fixtures - they're pure unit tests
  - Test classes organize related tests: under limit, over limit, paragraph boundaries, section headers, edge cases
  - Key behaviors tested: empty input, exact limit, multiple chunks, paragraph boundary preservation, section header prepending
  - Tests verify that section headers are prepended to subsequent chunks for context continuity
  - Edge case: single very long paragraph is kept intact even if exceeding max_chars (can't split mid-paragraph)
---

## 2026-01-22 - US-046
- **What was implemented**: Created comprehensive tests for SSE streaming endpoint
- **Files changed**:
  - `backend/tests/test_streaming.py` - 15 tests organized in 5 classes covering status events, item events, complete events, error events, and meeting not found
- **Learnings for future iterations:**
  - SSE events are parsed from response text by splitting on newlines and extracting `event:` and `data:` lines
  - Test SSE endpoints with TestClient just like regular endpoints - response.text contains the SSE event stream
  - Mock async generators for testing extract_stream by defining async functions that yield dictionaries
  - Async generator mocks need an unreachable `yield` statement to satisfy Python's type checker
  - Test classes help organize related tests: status events, item events, complete events, error events, edge cases
  - SSE tests verify event order (status before items, items before complete), event content, and error handling
---

## 2026-01-22 - US-047
- **What was implemented**: Created useStreaming React hook for consuming SSE streams from the extraction endpoint
- **Files changed**:
  - `ui/src/hooks/useStreaming.js` - New hook with EventSource connection, item accumulation, timeout handling, error handling, cleanup, and retry function
- **Learnings for future iterations:**
  - React hooks go in `ui/src/hooks/` directory
  - Import useStreaming: `import { useStreaming } from '../hooks/useStreaming'`
  - Hook returns `{ items, status, error, retry }` - items array accumulates as events arrive
  - EventSource events handled via `addEventListener('eventName', handler)` for custom event types
  - Connection timeout implemented with 30 second timer that resets on every event
  - Cleanup function closes EventSource and clears timeout - called on unmount or jobId change
  - EventSource.onerror handles both connection errors and closed states (readyState === CLOSED vs CONNECTING)
  - Use useRef to hold mutable values (EventSource, timeout) that shouldn't trigger re-renders
  - Use useCallback for functions that are dependencies in useEffect to avoid infinite loops
---

## 2026-01-22 - US-048
- **What was implemented**: Created StreamingPreview component for displaying extraction results as they arrive
- **Files changed**:
  - `ui/src/components/meetings/StreamingPreview.jsx` - Component displaying items grouped by section, with processing spinner, completion message, and error state with retry button
  - `ui/src/components/meetings/StreamingPreview.css` - Styling for sections, items, status indicators, and animations
- **Learnings for future iterations:**
  - StreamingPreview uses the `useStreaming` hook's return values: `items`, `status`, `error`, `onRetry`
  - Items are grouped by section using `useMemo` for efficient re-computation only when items change
  - Status values from useStreaming: 'idle', 'connecting', 'connected', 'processing', 'complete', 'error'
  - Component shows sections progressively as items arrive - empty sections hidden while processing, shown when complete
  - CSS animations (`streaming-item-appear`) provide smooth visual feedback for new items
  - 9 sections match backend Section enum: problems, user_goals, functional_requirements, data_needs, constraints, non_goals, risks_assumptions, open_questions, action_items
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-049
- **What was implemented**: Created RecapEditorPage shell for viewing meeting extraction results
- **Files changed**:
  - `ui/src/pages/RecapEditorPage.jsx` - New page component with conditional rendering based on meeting status (pending/processing shows StreamingPreview, processed shows placeholder, failed shows error with retry)
  - `ui/src/pages/RecapEditorPage.css` - Styling for loading, error, placeholder, and failed states
  - `ui/src/App.jsx` - Added route `/app/projects/:id/meetings/:mid` for RecapEditorPage
- **Learnings for future iterations:**
  - RecapEditorPage uses `useParams()` to extract `:id` (project) and `:mid` (meeting) from URL
  - Uses `useLocation()` to access navigation state (job_id passed from UploadMeetingPage)
  - The `useStreaming` hook is conditionally activated based on meeting status - pass null jobId when not needed
  - Retry functionality for failed extractions will call POST /api/meetings/{id}/retry endpoint (to be implemented in US-114)
  - Status-based rendering: pending/processing -> StreamingPreview, processed -> placeholder (RecapEditor in future), failed -> error with retry
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-050
- **What was implemented**: Verified streaming integration in upload flow (all components already implemented in previous stories)
- **Files changed**:
  - No new files - functionality was implemented across US-032, US-047, and US-049
  - `ui/src/pages/UploadMeetingPage.jsx` - Navigation to RecapEditorPage with job_id (implemented in US-032)
  - `ui/src/pages/RecapEditorPage.jsx` - Receives job_id and auto-starts streaming (implemented in US-049)
  - `ui/src/hooks/useStreaming.js` - Starts automatically when jobId is provided (implemented in US-047)
- **Learnings for future iterations:**
  - This story was an integration verification story - all acceptance criteria were satisfied by previous implementations
  - Upload flow: UploadMeetingPage → POST /api/meetings/upload → navigate to RecapEditorPage with job_id in state
  - RecapEditorPage extracts job_id from `location.state?.job_id` or falls back to URL param `mid`
  - useStreaming hook activates when meeting status is 'pending' or 'processing' (conditional jobId in line 20-22)
  - Always verify integration between components when marking "glue" stories as complete
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-051
- **What was implemented**: Created comprehensive tests for the useStreaming React hook
- **Files changed**:
  - `ui/tests/components/useStreaming.test.js` - 28 tests covering all hook functionality
- **Learnings for future iterations:**
  - React hook testing requires `@testing-library/react`'s `renderHook` and `act` utilities
  - Mock EventSource by creating a class with static constants (CONNECTING, OPEN, CLOSED), instance tracking arrays, and helper methods
  - Use `vi.useFakeTimers()` to test timeout behavior - can advance time with `vi.advanceTimersByTime(ms)`
  - Use `act()` wrapper when triggering state changes in hooks (e.g., simulating events)
  - Test classes organize related tests: connection, items, errors, onerror, timeout, retry, cleanup
  - Track closed instances separately (`closedInstances` array) to verify cleanup behavior
  - When testing rerenders with different props, use `renderHook` with `initialProps` and `rerender({ newProps })`
---

## 2026-01-22 - US-052
- **What was implemented**: Created MeetingItem update endpoint for editing extracted meeting items
- **Files changed**:
  - `backend/app/routers/meeting_items.py` - New router with PUT /api/meeting-items/{id} endpoint
  - `backend/app/routers/__init__.py` - Exported meeting_items_router
  - `backend/app/main.py` - Registered meeting_items_router
  - `backend/app/schemas/meeting.py` - Added MeetingItemUpdate schema
  - `backend/app/schemas/__init__.py` - Exported MeetingItemUpdate
- **Learnings for future iterations:**
  - Meeting item CRUD endpoints go in a separate router from meeting endpoints: `/api/meeting-items/`
  - Status validation pattern: query the parent MeetingRecap and check `meeting.status != MeetingStatus.processed`
  - Import MeetingItemUpdate: `from app.schemas import MeetingItemUpdate`
  - Use `# type: ignore[assignment]` for SQLAlchemy Column assignments to satisfy mypy
---

## 2026-01-22 - US-053
- **What was implemented**: Created MeetingItem delete endpoint for soft-deleting extracted meeting items
- **Files changed**:
  - `backend/app/routers/meeting_items.py` - Added DELETE /api/meeting-items/{id} endpoint
- **Learnings for future iterations:**
  - Soft-delete pattern: set `is_deleted = True` instead of hard deleting the record
  - DELETE endpoints return `status_code=status.HTTP_204_NO_CONTENT` and `None`
  - Same status validation as update endpoint - can only delete items from processed meetings
---

## 2026-01-22 - US-054
- **What was implemented**: Created MeetingItem add endpoint for adding new items to processed meetings
- **Files changed**:
  - `backend/app/routers/meetings.py` - Added POST /api/meetings/{id}/items endpoint
  - `backend/app/schemas/meeting.py` - Added MeetingItemCreate schema (section and content)
  - `backend/app/schemas/__init__.py` - Exported MeetingItemCreate
- **Learnings for future iterations:**
  - Add endpoints go on the parent resource router (meetings.py) with path `/{id}/items`
  - Use `sqlalchemy.func.max()` to calculate the next order value: `func.max(MeetingItem.order)`
  - Filter by `is_deleted == False` when calculating max order to ignore soft-deleted items
  - MeetingItemCreate schema uses `Section` enum directly from models for validation
---

## 2026-01-22 - US-055
- **What was implemented**: Created MeetingItem reorder endpoint for reordering items within a section
- **Files changed**:
  - `backend/app/routers/meetings.py` - Added PUT /api/meetings/{id}/items/reorder endpoint
  - `backend/app/schemas/meeting.py` - Added MeetingItemReorderRequest schema (section and item_ids)
  - `backend/app/schemas/__init__.py` - Exported MeetingItemReorderRequest
- **Learnings for future iterations:**
  - Reorder endpoint receives `section` and `item_ids` (list of string UUIDs) in request body
  - Use `enumerate(item_ids, start=1)` to assign new order values based on position
  - Create lookup dict by ID: `{str(item.id): item for item in items}` for efficient updates
  - Return items in new order by querying with `.order_by(MeetingItem.order)` after commit
  - Same status validation pattern: meeting status must be `processed` to allow reordering
---

## 2026-01-22 - US-056
- **What was implemented**: Created comprehensive tests for MeetingItem endpoints (update, soft-delete, add, reorder)
- **Files changed**:
  - `backend/tests/test_meeting_items.py` - 19 tests organized in 5 classes covering all MeetingItem CRUD operations
- **Learnings for future iterations:**
  - Helper functions `_set_meeting_status()` and `_create_meeting_item()` directly modify the database for test setup
  - Use `test_db` fixture (Session) for direct database manipulation in tests
  - Soft-delete is verified by checking `item.is_deleted is True` and that the item is excluded from GET /api/meetings/{id} response
  - Status validation tests cover all non-processed statuses: pending, processing, failed, applied
  - Test classes help organize tests by endpoint: TestUpdateMeetingItem, TestDeleteMeetingItem, TestAddMeetingItem, TestReorderMeetingItems, TestStatusValidation
---

## 2026-01-22 - US-057
- **What was implemented**: Created CollapsibleSection component for expandable/collapsible UI sections
- **Files changed**:
  - `ui/src/components/common/CollapsibleSection.jsx` - Component with title, item count, expand/collapse toggle, chevron icon animation
  - `ui/src/components/common/CollapsibleSection.css` - Styling with hover effects, focus states, and smooth transitions
- **Learnings for future iterations:**
  - CollapsibleSection accepts props: `title` (string), `itemCount` (number, optional), `children`, `defaultExpanded` (boolean, default true)
  - Use CSS `transform: rotate(90deg)` for chevron rotation animation on expand/collapse
  - Component uses `aria-expanded` attribute for accessibility
  - Item count displayed as a pill/badge in the header
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-058
- **What was implemented**: Created ItemRow component for displaying individual items with edit/delete actions and drag handle
- **Files changed**:
  - `ui/src/components/common/ItemRow.jsx` - Component with content display, edit button, delete button, drag handle icon
  - `ui/src/components/common/ItemRow.css` - Styling with hover states, action button visibility transitions
- **Learnings for future iterations:**
  - ItemRow accepts props: `item` (object with content field), `onEdit` (callback), `onDelete` (callback)
  - Action buttons hidden by default, revealed on row hover using CSS `opacity` transition
  - Drag handle uses 6-dot pattern (2x3 grid) with SVG circles for visual representation
  - Use `e.stopPropagation()` on action button clicks to prevent event bubbling
  - Consistent icon styling with ProjectCard: 16x16 SVG, stroke-based icons
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-059
- **What was implemented**: Created RecapEditor component for viewing extracted recap organized by sections
- **Files changed**:
  - `ui/src/components/meetings/RecapEditor.jsx` - Component displaying all 9 sections with CollapsibleSection, items with ItemRow, source_quote display
  - `ui/src/components/meetings/RecapEditor.css` - Styling for sections, items wrapper, source quote display (italic, smaller text)
- **Learnings for future iterations:**
  - RecapEditor accepts props: `items` (array), `onEditItem` (callback), `onDeleteItem` (callback)
  - Items are grouped by section using object initialization pattern (initialize all 9 sections as empty arrays, then populate)
  - SECTIONS constant matches backend Section enum order for consistent display
  - source_quote displayed below ItemRow in subtle style: smaller font (0.75rem), gray color, italic text, with "Source:" label
  - Empty section placeholder uses dashed border and italic text for visual distinction
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-060
- **What was implemented**: Added inline editing capability to ItemRow component
- **Files changed**:
  - `ui/src/components/common/ItemRow.jsx` - Added edit mode state management, textarea for editing, save/cancel buttons, API call to PUT /api/meeting-items/{id}, error handling
  - `ui/src/components/common/ItemRow.css` - Added styles for edit mode: editing container, textarea, save/cancel buttons, error message, disabled states
- **Learnings for future iterations:**
  - ItemRow now manages its own edit state internally using `useState` hooks (isEditing, editedContent, isSaving, error)
  - Edit mode renders a completely different JSX structure (conditional return)
  - Keyboard shortcuts: Escape to cancel, Ctrl+Enter to save
  - After successful save, `onEdit` callback receives the updated item from the API response (allows parent to update its state)
  - Error messages displayed inline within the edit container using red background styling
  - Save button disabled when content is empty or saving is in progress
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-061
- **What was implemented**: Added delete confirmation dialog to ItemRow component
- **Files changed**:
  - `ui/src/components/common/ItemRow.jsx` - Added confirmation dialog state (isConfirmingDelete, isDeleting, deleteError), handleDeleteClick opens dialog, handleCancelDelete/handleConfirmDelete handlers, confirmation UI with warning icon, API call to DELETE /api/meeting-items/{id}
  - `ui/src/components/common/ItemRow.css` - Added styles for delete confirmation: red-themed container, warning message, error display, cancel/confirm buttons
- **Learnings for future iterations:**
  - ItemRow now has three render states: normal view, edit mode, and delete confirmation mode
  - Delete confirmation uses same inline pattern as edit mode (conditional return based on state)
  - `del` function from api.js is used for DELETE requests (returns void on 204 No Content)
  - onDelete callback is called after successful API deletion to let parent remove item from list
  - Confirmation dialog shows warning icon (circle with exclamation) styled in red
  - Confirm button styled as destructive action (red background)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-062
- **What was implemented**: Added drag-and-drop reordering functionality to ItemRow and RecapEditor components
- **Files changed**:
  - `ui/src/components/common/ItemRow.jsx` - Added drag-and-drop props (draggable, onDragStart, onDragEnd, onDragOver, onDragLeave, onDrop, isDragging, isDragOver), implemented drag event handlers
  - `ui/src/components/common/ItemRow.css` - Added styles for dragging state (opacity, scale transform, blue highlight) and drag-over state (drop indicator line, border highlight)
  - `ui/src/components/meetings/RecapEditor.jsx` - Added drag-and-drop state management (draggedItem, dragOverItem, isReordering), implemented drag handlers with section-only restriction, calls PUT /api/meetings/{id}/items/reorder on drop
- **Learnings for future iterations:**
  - HTML5 drag-and-drop uses `draggable` attribute and drag event handlers (onDragStart, onDragEnd, onDragOver, onDragLeave, onDrop)
  - RecapEditor manages drag state centrally, passing isDragging and isDragOver booleans to ItemRows for styling
  - Section-only drag restriction: compare `draggedItem.section === targetItem.section` before allowing drop
  - Drop indicator implemented with CSS `::before` pseudo-element positioned above the target row
  - `e.preventDefault()` required in `onDragOver` and `onDrop` to allow drop events
  - `e.dataTransfer.effectAllowed = 'move'` sets the drag cursor style
  - Smooth animations achieved with CSS transitions on `transform`, `opacity`, and `box-shadow`
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-063
- **What was implemented**: Added ability to add new items to any section in the RecapEditor component
- **Files changed**:
  - `ui/src/components/meetings/RecapEditor.jsx` - Added state for add item form (addingToSection, newItemContent, isAddingSaving, addError), added handleStartAddItem/handleCancelAddItem/handleSubmitAddItem handlers, added onAddItem callback prop, renders "+ Add item" button at bottom of each section that opens inline textarea form
  - `ui/src/components/meetings/RecapEditor.css` - Added styles for add item button (dashed border, centered content, hover/focus states), add item form (textarea, error display, action buttons)
- **Learnings for future iterations:**
  - Add item form follows the same pattern as ItemRow edit mode: inline form replaces button when active
  - `onAddItem` callback receives the newly created item from the API response, allowing parent to update its items state
  - POST /api/meetings/{id}/items already implemented in US-054, accepts `section` and `content` in request body
  - Keyboard shortcuts: Escape to cancel, Ctrl+Enter to submit (consistent with ItemRow edit mode)
  - Add item button uses dashed border styling to indicate "add" action, similar to empty state styling
  - Only one section can have an active add form at a time (controlled by `addingToSection` state)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-064
- **What was implemented**: Integrated RecapEditor component into RecapEditorPage to show the editor when extraction is complete
- **Files changed**:
  - `ui/src/pages/RecapEditorPage.jsx` - Imported RecapEditor, added meetingItems state, added useEffect for streaming-to-processed transition, added callback handlers (handleEditItem, handleDeleteItem, handleReorderItems, handleAddItem), replaced placeholder with actual RecapEditor component
- **Learnings for future iterations:**
  - RecapEditorPage manages items state separately from meeting state, allowing real-time UI updates after edits
  - Transition from StreamingPreview to RecapEditor triggered by watching `streamStatus === 'complete'`
  - When streaming completes, we manually set meeting status to 'processed' in local state and copy streaming items to meetingItems
  - When page loads with already-processed meeting, items are initialized from `meetingData.items` in fetchMeeting
  - Callback handlers update local state immediately, providing responsive UI without refetching
  - handleReorderItems needs to preserve items from other sections when reordering one section
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-065
- **What was implemented**: Added Save & Apply button to RecapEditorPage for navigating to the apply/conflict resolver page
- **Files changed**:
  - `ui/src/pages/RecapEditorPage.jsx` - Added isSaving state, handleSaveAndApply handler, Save & Apply button with disabled state
  - `ui/src/pages/RecapEditorPage.css` - Added styles for .recap-editor-actions container and .save-apply-btn with hover/disabled states
- **Learnings for future iterations:**
  - Save & Apply button only appears when meeting status is 'processed' (showRecapEditor condition)
  - Button navigates to `/app/projects/:id/meetings/:mid/apply` for conflict resolution
  - Used isSaving state to disable button during navigation (prevents double-clicks)
  - Button styling consistent with other primary action buttons (teal color, 8px border radius)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-066
- **What was implemented**: Created comprehensive tests for RecapEditor and ItemRow components
- **Files changed**:
  - `ui/tests/components/RecapEditor.test.jsx` - 15 tests covering section display, source_quote display, add item functionality, drag-and-drop, edit callback
  - `ui/tests/components/ItemRow.test.jsx` - 30 tests covering basic rendering, inline editing, delete confirmation flow, drag-and-drop events
- **Learnings for future iterations:**
  - Mock `vi.mock('../../src/services/api', ...)` pattern for mocking API calls in component tests
  - jsdom's drag events don't include `dataTransfer`, so must provide it as `fireEvent.dragStart(el, { dataTransfer: { effectAllowed: '', setData: vi.fn() } })`
  - Test delete confirmation flow by checking for "Delete this item?" text and Cancel/Delete buttons
  - RecapEditor has 9 sections, test empty section count carefully (6 empty when 4 items are spread across 3 sections)
  - Use `waitFor()` for async API call assertions
---

## 2026-01-22 - US-067
- **What was implemented**: Created Requirement model for storing accumulated requirements from meetings
- **Files changed**:
  - `backend/app/models/requirement.py` - New Requirement model with id (UUID), project_id (FK), section (enum), content (text), order (int), is_active (bool), timestamps
  - `backend/app/models/__init__.py` - Updated to export Requirement
  - `backend/app/models/project.py` - Enabled requirements relationship with cascade delete
  - `backend/alembic/env.py` - Added Requirement import for autogenerate
  - `backend/alembic/versions/2f79be4b75bf_create_requirements_table.py` - Migration file
  - `backend/conftest.py` - Added Requirement import for test db setup
- **Learnings for future iterations:**
  - Requirement reuses the `Section` enum from `meeting_item.py` - import from there rather than redefining
  - is_active pattern used for soft-delete of requirements (vs is_deleted on MeetingItem)
  - Two composite indexes: (project_id, section) for section queries and (project_id, is_active) for filtering active requirements
  - Project model already had commented placeholder for requirements relationship - just uncomment it
---

## 2026-01-22 - US-068
- **What was implemented**: Created RequirementSource model for tracking which meetings contributed to each requirement
- **Files changed**:
  - `backend/app/models/requirement_source.py` - New RequirementSource model with id (UUID), requirement_id (FK with cascade), meeting_id (FK, SET NULL on delete), meeting_item_id (FK, nullable, SET NULL on delete), source_quote (text, nullable), created_at timestamp
  - `backend/app/models/requirement.py` - Added `sources` relationship with back_populates and cascade delete
  - `backend/app/models/__init__.py` - Updated to export RequirementSource
  - `backend/alembic/env.py` - Added RequirementSource import for autogenerate
  - `backend/alembic/versions/4a7f1d3ecf25_create_requirement_sources_table.py` - Migration file
  - `backend/conftest.py` - Added RequirementSource import for test db setup
- **Learnings for future iterations:**
  - RequirementSource uses `ondelete="SET NULL"` for meeting_id and meeting_item_id - this allows meetings to be deleted independently while preserving the requirement and its history
  - RequirementSource uses `ondelete="CASCADE"` for requirement_id - when a requirement is deleted, its sources are also deleted
  - Requirement model needed bidirectional relationship added: `sources = relationship("RequirementSource", back_populates="requirement", cascade="all, delete-orphan")`
  - Index on meeting_id enables efficient traceability queries to find all requirements derived from a specific meeting
---

## 2026-01-22 - US-069
- **What was implemented**: Created RequirementHistory model for auditing all changes to requirements
- **Files changed**:
  - `backend/app/models/requirement_history.py` - New RequirementHistory model with Actor enum (system, user, ai_extraction, ai_merge), Action enum (created, modified, deactivated, reactivated, merged), id (UUID), requirement_id (FK with CASCADE), meeting_id (FK, nullable, SET NULL on delete), actor, action, old_content, new_content, created_at
  - `backend/app/models/requirement.py` - Added `history` relationship with back_populates and cascade delete
  - `backend/app/models/__init__.py` - Updated to export RequirementHistory, Actor, Action
  - `backend/alembic/env.py` - Added RequirementHistory import for autogenerate
  - `backend/alembic/versions/77d97144f4ea_create_requirement_history_table.py` - Migration file
  - `backend/conftest.py` - Added RequirementHistory import for test db setup
- **Learnings for future iterations:**
  - Actor and Action enums inherit from `str, enum.Enum` for Pydantic serialization compatibility
  - RequirementHistory uses `ondelete="CASCADE"` for requirement_id - when a requirement is deleted, its history is also deleted
  - RequirementHistory uses `ondelete="SET NULL"` for meeting_id - meetings can be deleted independently while preserving the audit history
  - Index on requirement_id enables efficient queries for viewing a requirement's change history
  - Import RequirementHistory and enums: `from app.models import RequirementHistory, Actor, Action`
---

## 2026-01-22 - US-070
- **What was implemented**: Created Pydantic schemas for Requirements API validation
- **Files changed**:
  - `backend/app/schemas/requirement.py` - New file with RequirementSourceResponse, RequirementHistoryResponse, RequirementResponse, RequirementUpdate, RequirementsListResponse schemas
  - `backend/app/schemas/__init__.py` - Updated to export new schemas
- **Learnings for future iterations:**
  - RequirementResponse includes `sources: list[RequirementSourceResponse]` for meeting source traceability
  - RequirementResponse includes `history_count: int` for showing how many changes a requirement has (computed by router, not from_attributes)
  - RequirementsListResponse has all 9 section fields (problems, user_goals, etc.) for grouping requirements by section
  - Import requirement schemas: `from app.schemas import RequirementResponse, RequirementUpdate, RequirementsListResponse, RequirementHistoryResponse`
  - RequirementHistoryResponse imports Actor and Action enums from `app.models.requirement_history`
---

## 2026-01-22 - US-071
- **What was implemented**: Created Requirements list endpoint for viewing all active requirements grouped by section
- **Files changed**:
  - `backend/app/routers/requirements.py` - New router with GET /api/projects/{id}/requirements endpoint
  - `backend/app/routers/__init__.py` - Exported requirements_router
  - `backend/app/main.py` - Registered requirements_router
- **Learnings for future iterations:**
  - Requirements router follows same pattern as other routers - prefix `/api/projects` with tag `requirements`
  - `_build_requirement_response()` helper function builds RequirementResponse manually to include computed fields (sources, history_count)
  - history_count computed from `len(requirement.history)` - requires relationship to be loaded
  - Query uses `is_active == True` filter to exclude soft-deleted requirements
  - Order by `section, order` ensures consistent ordering within and across sections
  - Response grouped into RequirementsListResponse which has a field for each of the 9 sections
---

## 2026-01-22 - US-072
- **What was implemented**: Created Requirements update endpoint for editing requirement content
- **Files changed**:
  - `backend/app/routers/requirements.py` - Added PUT /api/requirements/{id} endpoint, updated router prefix from `/api/projects` to `/api` to support both project-scoped and direct requirement endpoints
- **Learnings for future iterations:**
  - Router prefix was updated from `/api/projects` to `/api` to support both patterns: `/api/projects/{id}/requirements` (list) and `/api/requirements/{id}` (update/delete)
  - PUT endpoint records history with actor=user, action=modified using RequirementHistory model
  - Store `old_content` before update to record in history
  - The `_build_requirement_response()` helper function is reused for consistent response format
  - Import RequirementHistory, Actor, Action from models for history recording
---

## 2026-01-22 - US-073
- **What was implemented**: Created Requirements delete endpoint for soft-deleting requirements
- **Files changed**:
  - `backend/app/routers/requirements.py` - Added DELETE /api/requirements/{id} endpoint with soft-delete pattern (sets is_active=False), records history with actor=user, action=deactivated
- **Learnings for future iterations:**
  - Soft-delete pattern for requirements: set `is_active = False` (vs `is_deleted = True` for MeetingItem)
  - DELETE endpoints return `status_code=status.HTTP_204_NO_CONTENT` and `None`
  - History entry for deactivation records old_content but sets new_content to None
  - Same router pattern as update endpoint - direct access via `/api/requirements/{id}`
---

## 2026-01-22 - US-074
- **What was implemented**: Created Requirements reorder endpoint for reordering requirements within a section
- **Files changed**:
  - `backend/app/schemas/requirement.py` - Added RequirementReorderRequest schema (section and requirement_ids)
  - `backend/app/schemas/__init__.py` - Exported RequirementReorderRequest
  - `backend/app/routers/requirements.py` - Added PUT /api/projects/{id}/requirements/reorder endpoint
- **Learnings for future iterations:**
  - RequirementReorderRequest follows same pattern as MeetingItemReorderRequest (section + array of IDs)
  - Reorder endpoint follows project-scoped pattern: `/api/projects/{id}/requirements/reorder`
  - Filter by `is_active == True` when getting requirements to exclude soft-deleted items
  - Returns simple `{"success": "true"}` response to match acceptance criteria "Returns 200 with success"
---

## 2026-01-22 - US-075
- **What was implemented**: Created Requirements history endpoint for viewing change history
- **Files changed**:
  - `backend/app/routers/requirements.py` - Added GET /api/requirements/{id}/history endpoint
- **Learnings for future iterations:**
  - History endpoint uses direct requirement path: `/api/requirements/{id}/history` (same router prefix pattern as update/delete)
  - Query ordered by `created_at.desc()` for newest-first ordering
  - RequirementHistory model has mixed column styles (Mapped vs Column) - use `# type: ignore[arg-type]` for created_at when building response
  - RequirementHistoryResponse schema already existed and was already exported from `__init__.py`
---

## 2026-01-22 - US-076
- **What was implemented**: Created Markdown export service for exporting requirements as Markdown documents
- **Files changed**:
  - `backend/app/services/exporter.py` - New service with export_markdown(project_id, db) function that generates formatted Markdown
  - `backend/app/services/__init__.py` - Updated exports to include export_markdown
- **Learnings for future iterations:**
  - Export service: `from app.services import export_markdown`
  - export_markdown() function signature: `export_markdown(project_id: UUID, db: Session) -> str`
  - SECTION_TITLES dict maps Section enum values to human-readable display names
  - SECTION_ORDER list ensures consistent ordering of all 9 sections
  - Query applied meetings with `MeetingStatus.applied` filter for sources table
  - Markdown table format uses pipe-separated columns with header row and separator row
  - Empty sections show "*No items in this section.*" in italics
  - Generated date uses UTC and `datetime.utcnow().strftime('%Y-%m-%d %H:%M:%S')` format
---

## 2026-01-22 - US-077
- **What was implemented**: Created Markdown export endpoint for downloading requirements as a Markdown file
- **Files changed**:
  - `backend/app/routers/requirements.py` - Added GET /api/projects/{id}/requirements/export endpoint with text/markdown Content-Type and Content-Disposition header
- **Learnings for future iterations:**
  - Export endpoint returns FastAPI `Response` with `media_type="text/markdown"` for correct content type
  - Use `Content-Disposition: attachment; filename="{name}"` header to suggest download filename
  - `_slugify_filename()` helper converts project name to safe filename (lowercase, hyphens, alphanumeric only)
  - `export_markdown()` service expects `UUID` type, so convert string project_id with `UUID(project_id)`
  - Catch `ValueError` from export_markdown (project not found) and re-raise as 404 HTTPException
---

## 2026-01-22 - US-078
- **What was implemented**: Created comprehensive tests for Requirements endpoints (CRUD and export)
- **Files changed**:
  - `backend/tests/test_requirements.py` - 29 tests organized in 6 classes covering list, update, delete, reorder, export, and history endpoints
- **Learnings for future iterations:**
  - Test classes organize related tests: TestListRequirements, TestUpdateRequirement, TestDeleteRequirement, TestReorderRequirements, TestExportRequirements, TestRequirementHistory
  - Helper functions `_create_requirement()`, `_create_meeting()`, `_create_requirement_source()` directly modify the database for test setup
  - Requirements use `is_active=False` for soft-delete (vs `is_deleted=True` for MeetingItems)
  - History is recorded with Actor.user and Action.modified/deactivated for user-triggered changes
  - Export tests verify Markdown format: header, sections, empty section placeholders, sources table, content-type, content-disposition
  - History endpoint returns entries ordered by `created_at.desc()` (newest first)
---

## 2026-01-22 - US-079
- **What was implemented**: Created RequirementsPage for viewing all requirements organized by section
- **Files changed**:
  - `ui/src/pages/RequirementsPage.jsx` - New page component fetching requirements from GET /api/projects/{id}/requirements, displays all 9 sections with CollapsibleSection and ItemRow components
  - `ui/src/pages/RequirementsPage.css` - Styling for loading state, error state, empty sections, and responsive layout
  - `ui/src/App.jsx` - Added route `/app/projects/:id/requirements` for RequirementsPage
- **Learnings for future iterations:**
  - RequirementsPage follows the same pattern as RecapEditorPage for fetching and displaying sectioned data
  - Requirements API returns data grouped by section (e.g., `requirements.problems`, `requirements.user_goals`, etc.)
  - Use SECTIONS constant array to maintain consistent ordering across UI (matches backend Section enum)
  - ItemRow can be used with `draggable={false}` for read-only display (editing/deletion to be added in subsequent stories)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-080
- **What was implemented**: Added inline editing to RequirementsPage using configurable ItemRow component
- **Files changed**:
  - `ui/src/components/common/ItemRow.jsx` - Added `apiEndpoint` prop that allows customizing the API endpoint (defaults to 'meeting-items' for backwards compatibility, can be set to 'requirements')
  - `ui/src/pages/RequirementsPage.jsx` - Added `handleEditItem` callback to update local state on successful edit, passes `apiEndpoint="requirements"` and `onEdit` props to ItemRow
- **Learnings for future iterations:**
  - ItemRow component now supports configurable API endpoints via `apiEndpoint` prop (e.g., 'meeting-items' or 'requirements')
  - This pattern allows reusing ItemRow across different resource types without code duplication
  - Default value of 'meeting-items' ensures backwards compatibility with RecapEditor
  - The same pattern will be used for delete functionality in US-081
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-081
- **What was implemented**: Added delete functionality to RequirementsPage with confirmation dialog
- **Files changed**:
  - `ui/src/pages/RequirementsPage.jsx` - Added `handleDeleteItem` callback that removes deleted items from local state, connected `onDelete` prop to ItemRow
- **Learnings for future iterations:**
  - ItemRow already had delete confirmation dialog functionality from US-061 and apiEndpoint support from US-080
  - RequirementsPage just needed to add the `handleDeleteItem` callback and pass `onDelete` prop to ItemRow
  - The reusable `apiEndpoint` prop pattern in ItemRow allows same component to work with different API resources (meeting-items vs requirements)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-082
- **What was implemented**: Added drag-and-drop reordering functionality to RequirementsPage
- **Files changed**:
  - `ui/src/pages/RequirementsPage.jsx` - Added drag state (draggedItem, dragOverItem, isReordering), implemented drag handlers (handleDragStart, handleDragEnd, handleDragOver, handleDragLeave, handleDrop), passed drag props to ItemRow, calls PUT /api/projects/{id}/requirements/reorder on drop
- **Learnings for future iterations:**
  - RequirementsPage follows the same drag-and-drop pattern as RecapEditor (US-062)
  - The drag-and-drop handlers need `useCallback` with appropriate dependencies (draggedItem, requirements, id)
  - Requirements reorder endpoint uses `requirement_ids` parameter (not `item_ids` like MeetingItems)
  - Local state is updated optimistically after successful API call using setRequirements with section-specific update
  - Items have a `section` property that matches the section key (e.g., 'problems', 'user_goals')
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-083
- **What was implemented**: Added source meeting links to each requirement item on RequirementsPage
- **Files changed**:
  - `backend/app/schemas/requirement.py` - Added `meeting_title` field to RequirementSourceResponse schema
  - `backend/app/routers/requirements.py` - Updated `_build_requirement_response()` to include meeting title from source relationship
  - `ui/src/pages/RequirementsPage.jsx` - Added source link display below each ItemRow, with multiple sources as comma-separated links
  - `ui/src/pages/RequirementsPage.css` - Added styles for source links (teal color, hover underline, italic label)
- **Learnings for future iterations:**
  - RequirementSource model has a `meeting` relationship that provides access to meeting title via `source.meeting.title`
  - Source links need to filter for sources with valid meeting_id (some sources may have null meeting_id if meeting was deleted)
  - Display format uses "Source: Link1, Link2" pattern with italic label and comma separators
  - Meeting title fallback to 'Meeting' if title is null (defensive coding)
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-084
- **What was implemented**: Created HistoryPopover component for viewing requirement change history
- **Files changed**:
  - `ui/src/components/requirements/HistoryPopover.jsx` - New component with popover that fetches and displays history from GET /api/requirements/{id}/history
  - `ui/src/components/requirements/HistoryPopover.css` - Styling for popover with loading, error, empty states, action color coding, content diff display
  - `ui/src/pages/RequirementsPage.jsx` - Added HistoryPopover import and display next to source links (only shown when history_count > 0)
  - `ui/src/pages/RequirementsPage.css` - Added `.requirement-meta` container for sources + history alignment
- **Learnings for future iterations:**
  - HistoryPopover uses click-outside and Escape key detection for closing the popover
  - Actor enum values (system, user, ai_extraction, ai_merge) formatted with human-readable labels
  - Action enum values (created, modified, deactivated, reactivated, merged) color-coded with CSS classes
  - Content changes shown with Before/After sections using red/green diff-like styling
  - Mobile responsive: popover becomes bottom sheet on narrow screens
  - Manual browser verification needed - no browser testing tools available
---

## 2026-01-22 - US-085
- **What was implemented**: Added Markdown export button to RequirementsPage for downloading requirements as Markdown file
- **Files changed**:
  - `ui/src/pages/RequirementsPage.jsx` - Added `isExporting` state, `handleExport` function (using fetch + blob download pattern), "Export as Markdown" button in page header with download icon SVG
  - `ui/src/pages/RequirementsPage.css` - Added styles for `.section-header-title`, `.export-btn` with hover/disabled states, mobile responsive styles
- **Learnings for future iterations:**
  - Export functionality uses raw `fetch` (not api.js wrapper) because we need blob response for file download
  - File download pattern: create blob URL, create anchor element, set download attribute, programmatically click, cleanup
  - Filename sanitization: `project.name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '')` removes spaces and non-alphanumeric characters
  - Same export implementation as ProjectDashboard for consistency
  - Button shows "Exporting..." text and is disabled during export operation
  - Manual browser verification needed - no browser testing tools available
---
